<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>HEARTBEAT™ - Cardiac Surgery Recovery Tracker</title>
  <style>
    :root{
      --bg:#0a0e1a;
      --card:#111827;
      --card-light:#1a2332;
      --ink:#e5e7eb;
      --muted:#9ca3af;
      --accent:#60a5fa;
      --good:#22c55e;
      --warn:#f59e0b;
      --bad:#ef4444;
      --purple:#a78bfa;
      --cyan:#06b6d4;
      --pink:#ec4899;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;padding:0}
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;
      background:linear-gradient(135deg,var(--bg),#0d1420 50%,#060812);
      color:var(--ink);
      line-height:1.5;
    }
    .container{max-width:1400px;margin:0 auto;padding:20px}
   
    header{
      background:linear-gradient(135deg,rgba(236,72,153,0.2),rgba(96,165,250,0.2));
      border:2px solid rgba(236,72,153,0.3);
      border-radius:16px;
      padding:24px;
      margin-bottom:24px;
      box-shadow:0 8px 32px rgba(236,72,153,0.3);
      position:relative;
      overflow:hidden;
    }
    header::before{
      content:'💓';
      position:absolute;
      right:20px;
      top:50%;
      transform:translateY(-50%);
      font-size:6rem;
      opacity:0.15;
      animation:heartbeat 1.5s ease-in-out infinite;
    }
    @keyframes heartbeat{
      0%, 100%{transform:translateY(-50%) scale(1)}
      25%{transform:translateY(-50%) scale(1.1)}
      50%{transform:translateY(-50%) scale(1)}
    }
    .header-content{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:16px;position:relative;z-index:1}
    .header-left{display:flex;align-items:center;gap:16px}
    .heart-icon{
      font-size:3.5rem;
      animation:heartbeat 1.5s ease-in-out infinite;
      filter:drop-shadow(0 0 20px rgba(236,72,153,0.6));
    }
    h1{margin:0;font-size:clamp(24px,3.5vw,32px);font-weight:800;letter-spacing:0.5px;background:linear-gradient(135deg,var(--pink),var(--accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
    .app-subtitle{color:var(--cyan);font-size:0.95rem;font-weight:600;margin-top:6px;letter-spacing:0.3px}
    .patient-info{color:var(--muted);font-size:0.95rem;margin-top:4px}
    .date-display{
      background:rgba(255,255,255,0.06);
      padding:10px 18px;
      border-radius:10px;
      font-weight:600;
      border:1px solid rgba(255,255,255,0.1);
      backdrop-filter:blur(10px);
    }
    .controls{
      display:flex;
      gap:10px;
      margin-bottom:20px;
      flex-wrap:wrap;
    }
    button, select{
      appearance:none;
      background:rgba(96,165,250,0.15);
      border:1px solid rgba(96,165,250,0.3);
      color:var(--ink);
      padding:10px 16px;
      border-radius:10px;
      cursor:pointer;
      font-weight:600;
      font-size:0.95rem;
      transition:all 0.2s;
    }
    button:hover{background:rgba(96,165,250,0.25);transform:translateY(-1px)}
    button:active{transform:translateY(0)}
   
    select{
      background:rgba(255,255,255,0.08);
      color:#ffffff;
    }
    select option{
      background:#1f2937;
      color:#ffffff;
      padding:8px;
    }
   
    .legend{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin-left:auto;
    }
    .pill{
      padding:6px 12px;
      border-radius:999px;
      font-size:0.85rem;
      font-weight:600;
    }
    .pill.good{background:rgba(34,197,94,0.2);border:1px solid rgba(34,197,94,0.4)}
    .pill.warn{background:rgba(245,158,11,0.2);border:1px solid rgba(245,158,11,0.4)}
    .pill.bad{background:rgba(239,68,68,0.2);border:1px solid rgba(239,68,68,0.4)}
    .entry-form{
      background:var(--card);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:16px;
      padding:24px;
      margin-bottom:24px;
      box-shadow:0 10px 40px rgba(0,0,0,0.5);
    }
   
    .section{
      margin-bottom:28px;
      padding-bottom:28px;
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .section:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
   
    .section-header{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:16px;
      color:var(--accent);
      font-weight:700;
      font-size:1.1rem;
      letter-spacing:0.3px;
    }
    .section-icon{font-size:1.3rem}
   
    .form-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(200px,1fr));
      gap:16px;
    }
    .form-grid.cols-2{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .form-grid.cols-3{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
    .form-grid.cols-4{grid-template-columns:repeat(auto-fit,minmax(180px,1fr))}
   
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{
      font-size:0.9rem;
      font-weight:600;
      color:var(--muted);
      display:flex;
      align-items:center;
      gap:6px;
    }
    .field input, .field select, .field textarea{
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.12);
      color:var(--ink);
      padding:10px 12px;
      border-radius:8px;
      font-size:0.95rem;
      font-family:inherit;
      transition:all 0.2s;
    }
    .field input:focus, .field select:focus, .field textarea:focus{
      outline:none;
      border-color:var(--accent);
      background:rgba(255,255,255,0.06);
    }
    .field textarea{resize:vertical;min-height:80px}
    .field input::placeholder{color:#6b7280}
   
    .pain-scale, .wellbeing-scale, .adl-scale{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .pain-btn, .wellbeing-btn, .adl-btn{
      flex:1;
      min-width:45px;
      padding:10px 8px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:8px;
      cursor:pointer;
      text-align:center;
      font-weight:600;
      transition:all 0.2s;
    }
    .pain-btn:hover, .wellbeing-btn:hover, .adl-btn:hover{background:rgba(255,255,255,0.08)}
    .pain-btn.selected, .wellbeing-btn.selected, .adl-btn.selected{
      background:var(--accent);
      border-color:var(--accent);
      color:#000;
    }
    .pain-btn.selected.high{background:var(--bad);border-color:var(--bad);color:#fff}
    .wellbeing-btn.selected.high, .adl-btn.selected.high{background:var(--good);border-color:var(--good);color:#fff}
    .wellbeing-btn.selected.low, .adl-btn.selected.low{background:var(--bad);border-color:var(--bad);color:#fff}
   
    .submit-section{
      margin-top:24px;
      padding-top:24px;
      border-top:2px solid rgba(236,72,153,0.3);
      display:flex;
      gap:12px;
      justify-content:flex-end;
    }
    .btn-primary{
      background:linear-gradient(135deg,var(--pink),var(--purple));
      border:none;
      padding:12px 32px;
      font-size:1rem;
      font-weight:700;
      color:#fff;
    }
    .btn-primary:hover{
      box-shadow:0 4px 20px rgba(236,72,153,0.5);
    }
   
    .history{
      background:var(--card);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:16px;
      padding:24px;
      box-shadow:0 10px 40px rgba(0,0,0,0.5);
    }
    .history-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
    }
    .history h2{margin:0;font-size:1.4rem;color:var(--pink)}
   
    .entries{max-height:600px;overflow-y:auto;margin-top:16px}
    .entry-card{
      background:var(--card-light);
      border:1px solid rgba(255,255,255,0.06);
      border-radius:12px;
      padding:16px;
      margin-bottom:12px;
      transition:all 0.2s;
    }
    .entry-card:hover{
      border-color:rgba(236,72,153,0.4);
      transform:translateX(2px);
    }
    .entry-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:12px;
      padding-bottom:8px;
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .entry-date{font-weight:700;color:var(--pink);font-size:1rem}
    .entry-time{color:var(--muted);font-size:0.9rem}
   
    .entry-data{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(150px,1fr));
      gap:12px;
      font-size:0.9rem;
    }
    .data-point{
      display:flex;
      flex-direction:column;
      gap:2px;
    }
    .data-label{color:var(--muted);font-size:0.85rem;font-weight:500}
    .data-value{font-weight:600;font-size:0.95rem}
   
    .alert-summary{
      background:rgba(239,68,68,0.1);
      border:1px solid rgba(239,68,68,0.3);
      border-radius:8px;
      padding:12px;
      margin-top:12px;
      color:var(--bad);
      font-weight:600;
      font-size:0.9rem;
    }
   
    .recovery-score-display{
      background:linear-gradient(135deg,rgba(96,165,250,0.2),rgba(167,139,250,0.2));
      border:2px solid rgba(96,165,250,0.4);
      border-radius:12px;
      padding:16px;
      margin-top:12px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .recovery-score-display.excellent{border-color:var(--good);background:linear-gradient(135deg,rgba(34,197,94,0.2),rgba(6,182,212,0.15))}
    .recovery-score-display.good{border-color:var(--cyan);background:rgba(6,182,212,0.15)}
    .recovery-score-display.fair{border-color:var(--warn);background:rgba(245,158,11,0.15)}
    .recovery-score-display.poor{border-color:var(--bad);background:rgba(239,68,68,0.15)}
    .recovery-score-display.critical{border-color:#dc2626;background:rgba(220,38,38,0.2);animation:pulse 2s infinite}
   
    @keyframes pulse{
      0%, 100%{opacity:1}
      50%{opacity:0.7}
    }
   
    .score-number{
      font-size:3rem;
      font-weight:800;
      line-height:1;
    }
    .score-grade{
      font-size:1.2rem;
      font-weight:700;
      margin-top:4px;
    }
    .score-label{
      font-size:0.9rem;
      color:var(--muted);
      margin-top:2px;
    }
   
    .empty-state{
      text-align:center;
      padding:48px 24px;
      color:var(--muted);
    }
   
    .helper-text{
      font-size:0.85rem;
      color:var(--muted);
      margin-top:4px;
      font-style:italic;
    }
   
    .medication-row{
      display:grid;
      grid-template-columns:2fr 1fr;
      gap:12px;
      align-items:end;
    }
   
    .walking-session{
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:8px;
    }
    .walking-session input{
      flex:1;
    }
    .add-session-btn{
      padding:8px 12px;
      font-size:0.85rem;
    }
   
    .footer-brand{
      text-align:center;
      margin-top:40px;
      padding:24px;
      border-top:2px solid rgba(236,72,153,0.3);
      color:var(--muted);
    }
    .brand-name{
      font-size:1.2rem;
      font-weight:800;
      background:linear-gradient(135deg,var(--pink),var(--purple));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      margin-bottom:4px;
    }
    .brand-tagline{
      font-size:0.9rem;
      color:var(--cyan);
      font-weight:600;
    }
   
    @media print{
      body{background:#fff;color:#000}
      .controls,.submit-section{display:none}
      .entry-form{border:1px solid #ccc}
    }
   
    @media (max-width:768px){
      .form-grid{grid-template-columns:1fr}
      .form-grid.cols-2,.form-grid.cols-3,.form-grid.cols-4{grid-template-columns:1fr}
      .header-content{flex-direction:column;align-items:flex-start}
      header::before{font-size:4rem;right:10px}
    }
    .checkbox-group{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
    }
    .checkbox-item{
      display:flex;
      align-items:center;
      gap:6px;
      padding:8px 12px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:8px;
      cursor:pointer;
      transition:all 0.2s;
    }
    .checkbox-item:hover{background:rgba(255,255,255,0.08)}
    .checkbox-item input[type="checkbox"]{
      cursor:pointer;
      width:18px;
      height:18px;
    }
    .checkbox-item.checked{
      background:rgba(96,165,250,0.2);
      border-color:var(--accent);
    }
   
    .cycle-indicator{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 12px;
      border-radius:8px;
      font-size:0.85rem;
      font-weight:600;
      background:rgba(167,139,250,0.2);
      border:1px solid rgba(167,139,250,0.4);
    }
   
    .adl-item{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:10px;
      padding:14px;
      margin-bottom:12px;
    }
    .adl-item-header{
      font-size:0.95rem;
      font-weight:600;
      color:var(--cyan);
      margin-bottom:10px;
    }
    /* NEW STYLES FOR SESSION 2 FEATURES */
    .med-adherence-item{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:10px;
      padding:14px;
      margin-bottom:12px;
    }
    .med-adherence-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .med-name{
      font-size:0.95rem;
      font-weight:600;
      color:var(--cyan);
    }
    .adherence-status{
      padding:4px 10px;
      border-radius:6px;
      font-size:0.8rem;
      font-weight:600;
    }
    .adherence-status.compliant{
      background:rgba(34,197,94,0.2);
      border:1px solid rgba(34,197,94,0.4);
      color:var(--good);
    }
    .adherence-status.missed{
      background:rgba(245,158,11,0.2);
      border:1px solid rgba(245,158,11,0.4);
      color:var(--warn);
    }
    .adherence-status.skipped{
      background:rgba(239,68,68,0.2);
      border:1px solid rgba(239,68,68,0.4);
      color:var(--bad);
    }
    .dose-tracker{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      margin-top:10px;
    }
    .dose-slot{
      padding:6px 12px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:6px;
      font-size:0.85rem;
      cursor:pointer;
      transition:all 0.2s;
    }
    .dose-slot:hover{background:rgba(255,255,255,0.08)}
    .dose-slot.taken{
      background:rgba(34,197,94,0.2);
      border-color:var(--good);
      color:var(--good);
    }
    .dose-slot.missed{
      background:rgba(239,68,68,0.2);
      border-color:var(--bad);
      color:var(--bad);
    }
   
    .vitamin-k-item{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:8px;
      padding:12px;
      margin-bottom:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .vitamin-k-food{
      font-weight:600;
      color:var(--cyan);
    }
    .vitamin-k-level{
      padding:4px 10px;
      border-radius:6px;
      font-size:0.8rem;
      font-weight:600;
    }
    .vitamin-k-level.high{
      background:rgba(239,68,68,0.2);
      border:1px solid var(--bad);
      color:var(--bad);
    }
    .vitamin-k-level.moderate{
      background:rgba(245,158,11,0.2);
      border:1px solid var(--warn);
      color:var(--warn);
    }
    .vitamin-k-level.low{
      background:rgba(34,197,94,0.2);
      border:1px solid var(--good);
      color:var(--good);
    }
   
    .wound-photo-upload{
      margin-top:12px;
      padding:16px;
      background:rgba(96,165,250,0.05);
      border:2px dashed rgba(96,165,250,0.3);
      border-radius:8px;
      text-align:center;
    }
    .wound-photo-upload input[type="file"]{
      display:none;
    }
    .upload-btn{
      background:var(--accent);
      color:#000;
      border:none;
      padding:10px 20px;
      border-radius:8px;
      font-weight:600;
      cursor:pointer;
    }
    .photo-preview{
      margin-top:12px;
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .photo-preview img{
      width:100px;
      height:100px;
      object-fit:cover;
      border-radius:8px;
      border:2px solid rgba(255,255,255,0.1);
    }
   
    .complication-warning{
      background:rgba(239,68,68,0.15);
      border:2px solid var(--bad);
      border-radius:10px;
      padding:16px;
      margin-top:12px;
      font-weight:600;
    }
   
    .side-effect-tracker{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:10px;
      padding:14px;
      margin-bottom:12px;
    }
    .side-effect-header{
      font-weight:600;
      color:var(--cyan);
      margin-bottom:8px;
    }
    .severity-scale{
      display:flex;
      gap:6px;
      margin-top:8px;
    }
    .severity-btn{
      flex:1;
      padding:6px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:6px;
      font-size:0.8rem;
      text-align:center;
      cursor:pointer;
      transition:all 0.2s;
    }
    .severity-btn:hover{background:rgba(255,255,255,0.08)}
    .severity-btn.selected{
      background:var(--warn);
      border-color:var(--warn);
      color:#000;
      font-weight:700;
    }
    .severity-btn.selected.severe{
      background:var(--bad);
      border-color:var(--bad);
      color:#fff;
    }
    .new-feature-badge{
      display:inline-block;
      background:linear-gradient(135deg,var(--pink),var(--purple));
      color:#fff;
      padding:2px 8px;
      border-radius:4px;
      font-size:0.75rem;
      font-weight:700;
      margin-left:8px;
      letter-spacing:0.5px;
    }
    /* NEW STYLES FOR SESSION 3 FEATURES */
    .phq9-question{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:10px;
      padding:14px;
      margin-bottom:12px;
    }
    .phq9-question-text{
      font-size:0.95rem;
      font-weight:600;
      color:var(--ink);
      margin-bottom:10px;
    }
    .phq9-options{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }
    .phq9-option{
      flex:1;
      min-width:120px;
      padding:10px 12px;
      background:rgba(255,255,255,0.04);
      border:1px solid rgba(255,255,255,0.12);
      border-radius:8px;
      cursor:pointer;
      text-align:center;
      font-size:0.85rem;
      transition:all 0.2s;
    }
    .phq9-option:hover{background:rgba(255,255,255,0.08)}
    .phq9-option.selected{
      background:var(--accent);
      border-color:var(--accent);
      color:#000;
      font-weight:600;
    }
    .phq9-score-display{
      background:linear-gradient(135deg,rgba(96,165,250,0.2),rgba(167,139,250,0.2));
      border:2px solid rgba(96,165,250,0.4);
      border-radius:12px;
      padding:16px;
      margin-top:16px;
      text-align:center;
    }
    .phq9-score-display.minimal{border-color:var(--good);background:rgba(34,197,94,0.15)}
    .phq9-score-display.mild{border-color:var(--cyan);background:rgba(6,182,212,0.15)}
    .phq9-score-display.moderate{border-color:var(--warn);background:rgba(245,158,11,0.15)}
    .phq9-score-display.moderately-severe{border-color:var(--bad);background:rgba(239,68,68,0.15)}
    .phq9-score-display.severe{border-color:#dc2626;background:rgba(220,38,38,0.2);animation:pulse 2s infinite}
    .phq9-score-number{
      font-size:2.5rem;
      font-weight:800;
      line-height:1;
    }
    .phq9-score-severity{
      font-size:1.1rem;
      font-weight:700;
      margin-top:8px;
    }
    .phq9-crisis-box{
      background:rgba(220,38,38,0.2);
      border:3px solid var(--bad);
      border-radius:12px;
      padding:20px;
      margin-top:16px;
      text-align:center;
    }
    .phq9-crisis-title{
      font-size:1.3rem;
      font-weight:800;
      color:var(--bad);
      margin-bottom:12px;
    }
    .phq9-crisis-number{
      font-size:2rem;
      font-weight:800;
      color:#fff;
      margin:12px 0;
      padding:12px;
      background:var(--bad);
      border-radius:8px;
    }
    .exercise-comparison{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:10px;
      padding:14px;
      margin-bottom:12px;
    }
    .exercise-metric{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
      padding-bottom:10px;
      border-bottom:1px solid rgba(255,255,255,0.06);
    }
    .exercise-metric:last-child{border-bottom:none;margin-bottom:0;padding-bottom:0}
    .exercise-metric-name{
      font-weight:600;
      color:var(--cyan);
    }
    .exercise-values{
      display:flex;
      gap:16px;
      align-items:center;
    }
    .exercise-value{
      text-align:center;
    }
    .exercise-value-label{
      font-size:0.75rem;
      color:var(--muted);
      text-transform:uppercase;
    }
    .exercise-value-number{
      font-size:1.1rem;
      font-weight:700;
    }
    .exercise-achievement{
      padding:4px 10px;
      border-radius:6px;
      font-size:0.8rem;
      font-weight:600;
    }
    .exercise-achievement.exceeded{
      background:rgba(34,197,94,0.2);
      border:1px solid var(--good);
      color:var(--good);
    }
    .exercise-achievement.met{
      background:rgba(6,182,212,0.2);
      border:1px solid var(--cyan);
      color:var(--cyan);
    }
    .exercise-achievement.below{
      background:rgba(245,158,11,0.2);
      border:1px solid var(--warn);
      color:var(--warn);
    }
    .provider-card{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:10px;
      padding:14px;
      margin-bottom:12px;
    }
    .provider-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .provider-name{
      font-size:1rem;
      font-weight:700;
      color:var(--cyan);
    }
    .provider-status{
      padding:4px 10px;
      border-radius:6px;
      font-size:0.8rem;
      font-weight:600;
    }
    .provider-status.current{
      background:rgba(34,197,94,0.2);
      border:1px solid var(--good);
      color:var(--good);
    }
    .provider-status.upcoming{
      background:rgba(6,182,212,0.2);
      border:1px solid var(--cyan);
      color:var(--cyan);
    }
    .provider-status.overdue{
      background:rgba(239,68,68,0.2);
      border:1px solid var(--bad);
      color:var(--bad);
    }
    .inr-history-item{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:8px;
      padding:12px;
      margin-bottom:8px;
      display:flex;
      justify-content:space-between;
      align-items:center;
    }
    .inr-date{
      font-weight:600;
      color:var(--cyan);
    }
    .inr-details{
      display:flex;
      gap:16px;
      align-items:center;
    }
    .inr-value{
      font-size:1.1rem;
      font-weight:700;
    }
    .inr-dose{
      font-size:0.9rem;
      color:var(--muted);
    }
    .inr-status{
      padding:4px 10px;
      border-radius:6px;
      font-size:0.8rem;
      font-weight:600;
    }
    .inr-status.therapeutic{
      background:rgba(34,197,94,0.2);
      border:1px solid var(--good);
      color:var(--good);
    }
    .inr-status.subtherapeutic{
      background:rgba(245,158,11,0.2);
      border:1px solid var(--warn);
      color:var(--warn);
    }
    .inr-status.supratherapeutic{
      background:rgba(239,68,68,0.2);
      border:1px solid var(--bad);
      color:var(--bad);
    }
    .device-reading{
      background:rgba(255,255,255,0.02);
      border:1px solid rgba(255,255,255,0.08);
      border-radius:10px;
      padding:14px;
      margin-bottom:12px;
    }
    .device-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
    }
    .device-name{
      font-size:0.95rem;
      font-weight:600;
      color:var(--cyan);
    }
    .device-timestamp{
      font-size:0.8rem;
      color:var(--muted);
    }
    .device-metrics{
      display:flex;
      gap:16px;
      flex-wrap:wrap;
    }
    .device-metric{
      flex:1;
      min-width:120px;
    }
    .device-metric-label{
      font-size:0.8rem;
      color:var(--muted);
    }
    .device-metric-value{
      font-size:1.2rem;
      font-weight:700;
    }
  </style>
  <!-- Firebase SDK for Backend Integration (Session 4 Feature 14) -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <div class="header-left">
          <div class="heart-icon">💓</div>
          <div>
            <h1>HEARTBEAT™</h1>
            <div class="app-subtitle">Healing Evaluation & Assessment for Recovery Tracking</div>
            <div class="patient-info">Triple Valve • Pacemaker • AFib Ablation • Comprehensive Recovery Monitor</div>
          </div>
        </div>
        <div class="date-display" id="currentDate"></div>
      </div>
    </header>
    <div class="controls">
      <button id="newEntry" class="btn-primary">➕ New Entry</button>
      <button id="exportCsv">⬇️ Export CSV</button>
      <button id="exportPdf">📄 Print/PDF</button>
      <div class="legend">
        <span class="pill good">✓ Normal</span>
        <span class="pill warn">⚠ Watch</span>
        <span class="pill bad">🚨 Alert</span>
      </div>
    </div>
    <div class="entry-form" id="entryForm">
      <form id="dataForm">
        <!-- BASIC INFO -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">📅</span>
            <span>Date & Time</span>
          </div>
          <div class="form-grid cols-3">
            <div class="field">
              <label>Date</label>
              <input type="date" id="entryDate" required>
            </div>
            <div class="field">
              <label>Time</label>
              <input type="time" id="entryTime" required>
            </div>
            <div class="field">
              <label>Surgery Date (set once)</label>
              <input type="date" id="surgeryDate" placeholder="Your surgery date">
              <span class="helper-text">Days post-op will auto-calculate</span>
            </div>
          </div>
          <div class="form-grid cols-3" style="margin-top:12px">
            <div class="field">
              <label>Days Post-Surgery</label>
              <input type="number" id="daysPostOp" min="0" placeholder="Auto-calculated" readonly>
            </div>
            <div class="field">
              <label>Baseline/Dry Weight (lbs or kg)</label>
              <input type="number" id="baselineWeight" step="0.1" placeholder="Your target weight">
              <span class="helper-text">Set your post-surgery target weight</span>
            </div>
            <div class="field">
              <label>Weight Deviation</label>
              <input type="text" id="weightDeviation" placeholder="Auto-calculated" readonly style="background:rgba(255,255,255,0.02)">
              <span class="helper-text">Difference from baseline</span>
            </div>
          </div>
        </div>
        <!-- NEW SESSION 3 FEATURE: HOME DEVICE INTEGRATION -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">📱</span>
            <span>Home Device Readings</span>
            <span class="new-feature-badge">SESSION 3</span>
          </div>
         
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            Record readings from your home monitoring devices. This ensures accuracy and tracks device compliance.
          </div>
          <div class="device-reading">
            <div class="device-header">
              <span class="device-name">🩺 Blood Pressure Monitor</span>
              <input type="time" id="bpDeviceTime" style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px 10px;border-radius:6px;font-size:0.85rem">
            </div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Device Brand/Model</label>
                <input type="text" id="bpDeviceBrand" placeholder="e.g., Omron Series 10">
              </div>
              <div class="field">
                <label>Systolic/Diastolic (mmHg)</label>
                <input type="text" id="bpDeviceReading" placeholder="e.g., 122/78" pattern="[0-9]{2,3}/[0-9]{2,3}">
              </div>
              <div class="field">
                <label>Pulse from BP Monitor (bpm)</label>
                <input type="number" id="bpDevicePulse" placeholder="e.g., 74">
              </div>
            </div>
            <div class="form-grid cols-2" style="margin-top:8px">
              <div class="field">
                <label>Measurement Arm</label>
                <select id="bpArm">
                  <option value="">Select...</option>
                  <option value="left">Left arm</option>
                  <option value="right">Right arm</option>
                </select>
              </div>
              <div class="field">
                <label>Position During Measurement</label>
                <select id="bpPosition">
                  <option value="">Select...</option>
                  <option value="seated-rest">Seated, after 5min rest</option>
                  <option value="seated-immediate">Seated, immediate</option>
                  <option value="lying">Lying down</option>
                  <option value="standing">Standing</option>
                </select>
              </div>
            </div>
          </div>
          <div class="device-reading">
            <div class="device-header">
              <span class="device-name">🫁 Pulse Oximeter</span>
              <input type="time" id="pulseOxTime" style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px 10px;border-radius:6px;font-size:0.85rem">
            </div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Device Brand/Model</label>
                <input type="text" id="pulseOxBrand" placeholder="e.g., Nonin Onyx II">
              </div>
              <div class="field">
                <label>SpO₂ Reading (%)</label>
                <input type="number" id="pulseOxReading" min="70" max="100" placeholder="e.g., 97">
              </div>
              <div class="field">
                <label>Heart Rate (bpm)</label>
                <input type="number" id="pulseOxHR" placeholder="e.g., 72">
              </div>
            </div>
            <div class="form-grid cols-2" style="margin-top:8px">
              <div class="field">
                <label>Finger Used</label>
                <select id="pulseOxFinger">
                  <option value="">Select...</option>
                  <option value="index">Index finger</option>
                  <option value="middle">Middle finger</option>
                  <option value="ring">Ring finger</option>
                </select>
              </div>
              <div class="field">
                <label>Signal Quality</label>
                <select id="pulseOxQuality">
                  <option value="">Select...</option>
                  <option value="excellent">Excellent (strong signal)</option>
                  <option value="good">Good</option>
                  <option value="fair">Fair (weak signal)</option>
                  <option value="poor">Poor (unreliable)</option>
                </select>
              </div>
            </div>
          </div>
          <div class="device-reading">
            <div class="device-header">
              <span class="device-name">⚖️ Digital Scale</span>
              <input type="time" id="scaleTime" style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px 10px;border-radius:6px;font-size:0.85rem">
            </div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Device Brand/Model</label>
                <input type="text" id="scaleBrand" placeholder="e.g., Withings Body+">
              </div>
              <div class="field">
                <label>Weight Reading (lbs or kg)</label>
                <input type="number" id="scaleReading" step="0.1" placeholder="e.g., 165.2">
              </div>
              <div class="field">
                <label>Measurement Timing</label>
                <select id="scaleTimimg">
                  <option value="">Select...</option>
                  <option value="morning-empty">Morning, empty bladder</option>
                  <option value="morning-after-eating">Morning, after eating</option>
                  <option value="evening">Evening</option>
                  <option value="after-exercise">After exercise</option>
                </select>
              </div>
            </div>
          </div>
          <div class="device-reading">
            <div class="device-header">
              <span class="device-name">⚡ Pacemaker Home Monitor</span>
              <input type="time" id="pacemakerTime" style="background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px 10px;border-radius:6px;font-size:0.85rem">
            </div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Device System</label>
                <input type="text" id="pacemakerSystem" placeholder="e.g., Medtronic CareLink">
              </div>
              <div class="field">
                <label>Transmission Status</label>
                <select id="pacemakerTransmission">
                  <option value="">Select...</option>
                  <option value="successful">Successful transmission</option>
                  <option value="failed">Failed transmission</option>
                  <option value="not-transmitted">Not transmitted today</option>
                  <option value="scheduled">Scheduled for later</option>
                </select>
              </div>
              <div class="field">
                <label>Any Alerts from Device?</label>
                <select id="pacemakerAlerts">
                  <option value="">Select...</option>
                  <option value="none">No alerts</option>
                  <option value="battery">Battery alert</option>
                  <option value="lead">Lead impedance alert</option>
                  <option value="arrhythmia">Arrhythmia detected</option>
                  <option value="other">Other alert</option>
                </select>
              </div>
            </div>
            <!-- SESSION 4 FEATURE 13: Pacemaker Interrogation Data -->
            <div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.06)">
              <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Pacemaker Interrogation Data</div>
              <div class="form-grid cols-3">
                <div class="field">
                  <label>% Atrial Paced</label>
                  <input type="number" id="pacemakerAtrialPaced" min="0" max="100" placeholder="e.g., 45">
                </div>
                <div class="field">
                  <label>% Ventricular Paced</label>
                  <input type="number" id="pacemakerVentricularPaced" min="0" max="100" placeholder="e.g., 90">
                </div>
                <div class="field">
                  <label>Battery Status (% or years remaining)</label>
                  <input type="text" id="pacemakerBattery" placeholder="e.g., 85% or 2 years">
                </div>
                <div class="field">
                  <label>Atrial Lead Impedance (ohms)</label>
                  <input type="number" id="pacemakerAtrialImpedance" placeholder="e.g., 550">
                </div>
                <div class="field">
                  <label>Ventricular Lead Impedance (ohms)</label>
                  <input type="number" id="pacemakerVentricularImpedance" placeholder="e.g., 620">
                </div>
              </div>
            </div>
            <div class="field" style="margin-top:8px">
              <label>Pacemaker Data Summary (if available)</label>
              <textarea id="pacemakerData" placeholder="e.g., % paced, battery level, any events captured..."></textarea>
            </div>
          </div>
          <div class="field">
            <label>Device Calibration Notes</label>
            <textarea id="deviceNotes" placeholder="Note any device issues, calibration dates, battery replacements, troubleshooting..."></textarea>
          </div>
        </div>
        <!-- VITAL SIGNS -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">❤️</span>
            <span>Vital Signs</span>
          </div>
          <div class="form-grid cols-3">
            <div class="field">
              <label>Weight (lbs or kg)</label>
              <input type="number" id="weight" step="0.1" placeholder="e.g., 165.5">
              <span class="helper-text">Morning weight before eating</span>
            </div>
            <div class="field">
              <label>Blood Pressure (mmHg)</label>
              <input type="text" id="bloodPressure" placeholder="e.g., 120/75" pattern="[0-9]{2,3}/[0-9]{2,3}">
              <span class="helper-text">Target: 90-140/50-90 (post-surgery)</span>
            </div>
            <div class="field">
              <label>Heart Rate (bpm)</label>
              <input type="number" id="heartRate" min="30" max="200" placeholder="e.g., 72">
              <span class="helper-text">Target: 55-100 bpm (on beta blockers)</span>
            </div>
            <div class="field">
              <label>O₂ Saturation (%)</label>
              <input type="number" id="oxygenSat" min="70" max="100" placeholder="e.g., 97">
              <span class="helper-text">Target: ≥94% (alert if <92%)</span>
            </div>
            <div class="field">
              <label>Temperature (°F)</label>
              <input type="number" id="temperature" step="0.1" min="95" max="105" placeholder="e.g., 98.6">
              <span class="helper-text">Normal: 97.0-99.5°F (alert if >100.4°F)</span>
            </div>
            <div class="field">
              <label>Respiratory Rate (breaths/min)</label>
              <input type="number" id="respRate" min="8" max="40" placeholder="e.g., 16">
              <span class="helper-text">Normal: 12-20 breaths/min</span>
            </div>
          </div>
        </div>
        <!-- CARDIAC RHYTHM & PACEMAKER -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">⚡</span>
            <span>Cardiac Rhythm & Pacemaker</span>
          </div>
          <div class="form-grid cols-3">
            <div class="field">
              <label>Heart Rhythm</label>
              <select id="rhythm">
                <option value="">Select...</option>
                <option value="regular">Regular/Normal Sinus</option>
                <option value="irregular">Irregular (AFib)</option>
                <option value="paced">Paced Rhythm</option>
                <option value="intermittent-afib">Intermittent AFib</option>
                <option value="atrial-flutter">Atrial Flutter</option>
                <option value="pvcs">PVCs (Premature Ventricular Contractions)</option>
                <option value="pacs">PACs (Premature Atrial Contractions)</option>
                <option value="bigeminy">Bigeminy</option>
                <option value="trigeminy">Trigeminy</option>
                <option value="svt">SVT (Supraventricular Tachycardia)</option>
                <option value="vtach">Ventricular Tachycardia</option>
                <option value="heart-block-1st">First Degree Heart Block</option>
                <option value="heart-block-2nd">Second Degree Heart Block</option>
                <option value="heart-block-3rd">Third Degree Heart Block</option>
                <option value="bradycardia">Bradycardia (pacemaker not capturing)</option>
              </select>
            </div>
            <div class="field">
              <label>Palpitations Frequency</label>
              <select id="palpitations">
                <option value="">Select...</option>
                <option value="none">None</option>
                <option value="rare">Rare (1-2/day)</option>
                <option value="occasional">Occasional (several/day)</option>
                <option value="frequent">Frequent (many/hour)</option>
                <option value="constant">Constant</option>
              </select>
            </div>
            <div class="field">
              <label>Pacemaker Concerns</label>
              <select id="pacemakerIssues">
                <option value="">Select...</option>
                <option value="none">None - functioning normally</option>
                <option value="hiccups">Hiccups/twitching</option>
                <option value="pocket-discomfort">Pocket discomfort</option>
                <option value="unusual-sensations">Unusual sensations</option>
                <option value="other">Other (note below)</option>
              </select>
            </div>
          </div>
        </div>
        <!-- PAIN ASSESSMENT WITH POSITION/CONTEXT -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🩹</span>
            <span>Pain Assessment (0 = No Pain, 10 = Worst Pain)</span>
          </div>
          <div class="form-grid cols-2">
            <div class="field">
              <label>Surgical/Chest Pain (0-10)</label>
              <div class="pain-scale" id="chestPainScale"></div>
            </div>
            <div class="field">
              <label>General Body Pain (0-10)</label>
              <div class="pain-scale" id="bodyPainScale"></div>
            </div>
          </div>
          <!-- SESSION 4 FEATURE 11: Pain Trend Tracking -->
          <div class="form-grid cols-2" style="margin-top:16px">
            <div class="field">
              <label>Chest Pain Trend vs Yesterday</label>
              <select id="chestPainTrend">
                <option value="">Select...</option>
                <option value="better">Better</option>
                <option value="same">Same</option>
                <option value="worse">Worse</option>
              </select>
            </div>
            <div class="field">
              <label>Body Pain Trend vs Yesterday</label>
              <select id="bodyPainTrend">
                <option value="">Select...</option>
                <option value="better">Better</option>
                <option value="same">Same</option>
                <option value="worse">Worse</option>
              </select>
            </div>
          </div>
         
          <div class="form-grid cols-3" style="margin-top:16px">
            <div class="field">
              <label>Pain Location</label>
              <input type="text" id="painLocation" placeholder="e.g., sternum, left shoulder">
            </div>
            <div class="field">
              <label>Pain Type</label>
              <select id="painType">
                <option value="">Select...</option>
                <option value="none">No pain</option>
                <option value="sharp">Sharp/stabbing</option>
                <option value="dull">Dull ache</option>
                <option value="burning">Burning</option>
                <option value="pressure">Pressure/tightness</option>
                <option value="shooting">Shooting</option>
              </select>
            </div>
            <div class="field">
              <label>Incision Status</label>
              <select id="incisionStatus">
                <option value="">Select...</option>
                <option value="healing-well">Healing well</option>
                <option value="some-redness">Some redness</option>
                <option value="drainage">Drainage present</option>
                <option value="swelling">Swelling</option>
                <option value="separation">Wound separation</option>
                <option value="concerning">Concerning - call doctor</option>
              </select>
            </div>
          </div>
          <div style="margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.06)">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Pain Position & Context</div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Position When Pain Worst</label>
                <select id="painPosition">
                  <option value="">Select...</option>
                  <option value="lying-flat">Lying flat on back</option>
                  <option value="lying-side">Lying on side</option>
                  <option value="leaning-back">Leaning back</option>
                  <option value="sitting-upright">Sitting upright</option>
                  <option value="standing">Standing</option>
                  <option value="bending-forward">Bending forward</option>
                  <option value="no-specific">No specific position</option>
                </select>
              </div>
              <div class="field">
                <label>What Makes Pain Worse</label>
                <select id="painTrigger">
                  <option value="">Select...</option>
                  <option value="deep-breathing">Deep breathing</option>
                  <option value="twisting">Twisting/rotating</option>
                  <option value="reaching">Reaching overhead</option>
                  <option value="coughing">Coughing/sneezing</option>
                  <option value="movement">Any movement</option>
                  <option value="showering">Showering/personal care</option>
                  <option value="dressing">Getting dressed</option>
                  <option value="nothing">Nothing makes it worse</option>
                </select>
              </div>
              <div class="field">
                <label>Activity When Pain Occurred</label>
                <select id="painActivity">
                  <option value="">Select...</option>
                  <option value="resting">Resting/no activity</option>
                  <option value="walking">Walking</option>
                  <option value="household">Household tasks</option>
                  <option value="personal-care">Personal care (shower/dressing)</option>
                  <option value="working">Working at desk</option>
                  <option value="sleeping">Trying to sleep</option>
                  <option value="exercise">Exercise/rehab</option>
                </select>
              </div>
            </div>
          </div>
        </div>
        <!-- DETAILED WOUND ASSESSMENT -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🔬</span>
            <span>Detailed Wound Assessment</span>
            <span class="new-feature-badge">SESSION 2</span>
          </div>
         
          <div class="form-grid cols-3">
            <div class="field">
              <label>Drainage Amount</label>
              <select id="drainageAmount">
                <option value="">Select...</option>
                <option value="none">None - completely dry</option>
                <option value="minimal">Minimal (small spot on dressing)</option>
                <option value="small">Small amount (quarter-size)</option>
                <option value="moderate">Moderate (half-dollar size)</option>
                <option value="large">Large (soaking through dressing)</option>
              </select>
            </div>
            <div class="field">
              <label>Drainage Color</label>
              <select id="drainageColor">
                <option value="">Select...</option>
                <option value="none">No drainage</option>
                <option value="clear">Clear/serous</option>
                <option value="blood-tinged">Blood-tinged/pink</option>
                <option value="yellow">Yellow/serosanguinous</option>
                <option value="green-yellow">Green-yellow (purulent - call doctor!)</option>
                <option value="brown">Brown/foul-smelling (infection - call doctor!)</option>
              </select>
            </div>
            <div class="field">
              <label>Wound Warmth</label>
              <select id="woundWarmth">
                <option value="">Select...</option>
                <option value="normal">Normal temperature</option>
                <option value="slightly-warm">Slightly warmer than surrounding skin</option>
                <option value="warm">Noticeably warm</option>
                <option value="hot">Hot to touch (concerning!)</option>
              </select>
            </div>
          </div>
          <div class="form-grid cols-3" style="margin-top:12px">
            <div class="field">
              <label>Redness Extent</label>
              <select id="rednessExtent">
                <option value="">Select...</option>
                <option value="none">No redness</option>
                <option value="incision-line">At incision line only</option>
                <option value="1cm">Extends 1cm from incision</option>
                <option value="2cm">Extends 2cm from incision</option>
                <option value="spreading">Spreading/worsening (call doctor!)</option>
              </select>
            </div>
            <div class="field">
              <label>Wound Edges</label>
              <select id="woundEdges">
                <option value="">Select...</option>
                <option value="well-approximated">Well-approximated (closed)</option>
                <option value="slightly-separated">Slightly separated (<5mm)</option>
                <option value="gaping">Gaping (>5mm - call doctor!)</option>
                <option value="dehiscence">Wound dehiscence (EMERGENCY!)</option>
              </select>
            </div>
            <div class="field">
              <label>Surrounding Skin</label>
              <select id="surroundingSkin">
                <option value="">Select...</option>
                <option value="normal">Normal appearance</option>
                <option value="dry">Dry/flaky</option>
                <option value="irritated">Irritated from dressing</option>
                <option value="bruised">Bruising (normal healing)</option>
                <option value="blistering">Blistering (notify doctor)</option>
              </select>
            </div>
          </div>
          <div class="wound-photo-upload">
            <label for="woundPhotos" class="upload-btn">📸 Upload Wound Photos</label>
            <input type="file" id="woundPhotos" accept="image/*" multiple>
            <div style="margin-top:8px;font-size:0.85rem;color:var(--muted)">
              Take photos in good lighting. Helpful for tracking healing progress.
            </div>
            <div class="photo-preview" id="photoPreview"></div>
          </div>
        </div>
        <!-- SYMPTOMS -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🫁</span>
            <span>Symptoms</span>
          </div>
          <div class="form-grid cols-3">
            <div class="field">
              <label>Shortness of Breath</label>
              <select id="shortnessOfBreath">
                <option value="">Select...</option>
                <option value="none">None</option>
                <option value="mild-exertion">Only with significant exertion</option>
                <option value="moderate-exertion">With moderate activity</option>
                <option value="minimal-exertion">With minimal activity</option>
                <option value="at-rest">At rest</option>
                <option value="lying-down">When lying down</option>
                <option value="night">Waking up at night</option>
              </select>
            </div>
            <div class="field">
              <label>Fatigue Level</label>
              <select id="fatigue">
                <option value="">Select...</option>
                <option value="none">None - normal energy</option>
                <option value="mild">Mild - slightly tired</option>
                <option value="moderate">Moderate - limited activity</option>
                <option value="severe">Severe - exhausted most of day</option>
                <option value="extreme">Extreme - can barely function</option>
              </select>
            </div>
            <div class="field">
              <label>Dizziness/Lightheadedness</label>
              <select id="dizziness">
                <option value="">Select...</option>
                <option value="none">None</option>
                <option value="occasional">Occasional when standing</option>
                <option value="frequent">Frequent</option>
                <option value="severe">Severe/near fainting</option>
                <option value="syncope">Actual fainting</option>
              </select>
            </div>
          </div>
         
          <div class="form-grid cols-3" style="margin-top:12px">
            <div class="field">
              <label>Swelling/Edema</label>
              <select id="swelling">
                <option value="">Select...</option>
                <option value="none">None</option>
                <option value="ankle">Ankle only</option>
                <option value="leg">Leg swelling</option>
                <option value="bilateral">Both legs</option>
                <option value="abdomen">Abdominal distension</option>
                <option value="generalized">Generalized</option>
              </select>
            </div>
            <div class="field">
              <label>Nausea/Appetite</label>
              <select id="nausea">
                <option value="">Select...</option>
                <option value="good-appetite">Good appetite</option>
                <option value="decreased-appetite">Decreased appetite</option>
                <option value="mild-nausea">Mild nausea</option>
                <option value="moderate-nausea">Moderate nausea</option>
                <option value="severe-nausea">Severe nausea/vomiting</option>
              </select>
            </div>
            <div class="field">
              <label>Sleep Quality (hours)</label>
              <input type="number" id="sleepHours" step="0.5" min="0" max="24" placeholder="e.g., 6.5">
            </div>
            <div class="field">
              <label>Sleep Position</label>
              <select id="sleepPosition">
                <option value="">Select...</option>
                <option value="flat">Completely flat on back</option>
                <option value="1-2-pillows">Elevated 1-2 pillows</option>
                <option value="3-plus-pillows">Elevated 3+ pillows</option>
                <option value="recliner">Sleeping in recliner/chair</option>
                <option value="cannot-lie-flat">Cannot lie flat (orthopnea)</option>
              </select>
              <span class="helper-text">Track breathing difficulty when lying down</span>
            </div>
            <div class="field">
              <label>Waking Due to Breathing</label>
              <select id="wakingSOB">
                <option value="">Select...</option>
                <option value="no">No - slept through</option>
                <option value="once">Once during night</option>
                <option value="multiple">Multiple times (concerning)</option>
                <option value="unable-to-sleep">Unable to sleep due to SOB</option>
              </select>
            </div>
          </div>
          <div class="form-grid cols-3" style="margin-top:12px">
            <div class="field">
              <label>Cough</label>
              <select id="cough">
                <option value="">Select...</option>
                <option value="none">None</option>
                <option value="occasional-dry">Occasional dry cough</option>
                <option value="frequent-dry">Frequent dry cough</option>
                <option value="productive">Productive cough</option>
                <option value="bloody">Coughing blood (call doctor!)</option>
              </select>
            </div>
            <div class="field">
              <label>Anxiety/Mood</label>
              <select id="mood">
                <option value="">Select...</option>
                <option value="good">Good/positive</option>
                <option value="neutral">Neutral</option>
                <option value="anxious">Anxious/worried</option>
                <option value="depressed">Depressed/down</option>
                <option value="severe-anxiety">Severe anxiety/panic</option>
              </select>
            </div>
            <div class="field">
              <label>Sternum Clicking/Popping</label>
              <select id="sternumClicking">
                <option value="">Select...</option>
                <option value="none">None</option>
                <option value="mild">Mild clicking occasionally</option>
                <option value="moderate">Moderate clicking</option>
                <option value="painful">Painful clicking</option>
                <option value="concerning">Very concerning</option>
              </select>
            </div>
          </div>
          <div class="form-grid cols-3" style="margin-top:12px">
            <div class="field">
              <label>Last Bowel Movement</label>
              <select id="bowelMovement">
                <option value="">Select...</option>
                <option value="today">Today</option>
                <option value="yesterday">Yesterday (1 day ago)</option>
                <option value="2-days">2 days ago</option>
                <option value="3-days">3 days ago (concerning)</option>
                <option value="4-plus-days">4+ days ago (alert doctor)</option>
              </select>
              <span class="helper-text">Constipation risk with pain meds</span>
            </div>
            <div class="field">
              <label>Stool Consistency</label>
              <select id="stoolConsistency">
                <option value="">Select...</option>
                <option value="normal">Normal/soft</option>
                <option value="hard">Hard/difficult to pass</option>
                <option value="loose">Loose/diarrhea</option>
                <option value="bloody">Bloody stool (call doctor)</option>
              </select>
            </div>
            <div class="field">
              <label>Straining During BM</label>
              <select id="bmStraining">
                <option value="">Select...</option>
                <option value="none">No straining</option>
                <option value="mild">Mild straining</option>
                <option value="moderate">Moderate straining</option>
                <option value="severe">Severe straining (dangerous for sternum)</option>
              </select>
            </div>
          </div>
        </div>
        <!-- POST-OP COMPLICATION SCREENING -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🚨</span>
            <span>Post-Operative Complication Screening</span>
            <span class="new-feature-badge">SESSION 2</span>
          </div>
         
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            Screen for common post-cardiac surgery complications. Check any symptoms present.
          </div>
         
          <div style="margin-bottom:20px">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Post-Pericardiotomy Syndrome (Dressler's Syndrome)</div>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="pericardiotomy" value="chest-pain-worse-breathing">
                <span>Chest pain worse with breathing/lying flat</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="pericardiotomy" value="fever-postop">
                <span>Low-grade fever (weeks after surgery)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="pericardiotomy" value="pericardial-rub">
                <span>Pericardial friction rub (scratchy sound)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="pericardiotomy" value="malaise">
                <span>General malaise/feeling unwell</span>
              </label>
            </div>
          </div>
          <div style="margin-bottom:20px">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Pleural Effusion (Fluid Around Lungs)</div>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="pleural" value="sob-progressive">
                <span>Progressive shortness of breath</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="pleural" value="decreased-breath-sounds">
                <span>Decreased breath sounds on one side</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="pleural" value="dullness-percussion">
                <span>Dullness to percussion (if checked)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="pleural" value="pleuritic-pain">
                <span>Sharp pain with deep breathing</span>
              </label>
            </div>
          </div>
          <div style="margin-bottom:20px">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Pericardial Effusion (Fluid Around Heart)</div>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="pericardial" value="muffled-heart-sounds">
                <span>Muffled heart sounds (if assessed)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="pericardial" value="jvd">
                <span>Jugular venous distension (bulging neck veins)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="pericardial" value="hypotension">
                <span>Low blood pressure</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="pericardial" value="pulsus-paradoxus">
                <span>Pulsus paradoxus (BP drop with inspiration)</span>
              </label>
            </div>
          </div>
          <div style="margin-bottom:20px">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Cardiac Tamponade (EMERGENCY)</div>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="tamponade" value="becks-triad">
                <span>Beck's Triad: Low BP + Muffled sounds + JVD</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="tamponade" value="severe-sob">
                <span>Severe shortness of breath</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="tamponade" value="tachycardia-severe">
                <span>Severe tachycardia</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="tamponade" value="altered-consciousness">
                <span>Altered consciousness/confusion</span>
              </label>
            </div>
          </div>
          <div id="complicationAlert" style="display:none" class="complication-warning">
            ⚠️ WARNING: You've indicated symptoms concerning for serious post-operative complications. Contact your cardiac surgeon or cardiologist TODAY. If symptoms are severe, go to the emergency room.
          </div>
        </div>
        <!-- STERNAL PRECAUTIONS COMPLIANCE -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🛡️</span>
            <span>Sternal Precautions Compliance (Post-Sternotomy)</span>
          </div>
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            Following these precautions is CRITICAL for sternum healing (typically 6-8 weeks minimum)
          </div>
         
          <div class="form-grid cols-3">
            <div class="field">
              <label>Lifting Restriction Compliance</label>
              <select id="liftingCompliance">
                <option value="">Select...</option>
                <option value="compliant">Compliant - No lifting >5-10 lbs</option>
                <option value="minor-violation">Minor violation (lifted 10-15 lbs)</option>
                <option value="moderate-violation">Moderate violation (lifted 15-25 lbs)</option>
                <option value="major-violation">Major violation (lifted >25 lbs)</option>
              </select>
            </div>
            <div class="field">
              <label>Pushing/Pulling Activities</label>
              <select id="pushPullCompliance">
                <option value="">Select...</option>
                <option value="avoided">Avoided all pushing/pulling</option>
                <option value="light">Light pushing/pulling only</option>
                <option value="moderate">Moderate pushing/pulling</option>
                <option value="heavy">Heavy pushing/pulling (concerning)</option>
              </select>
            </div>
            <div class="field">
              <label>Arm Movement Restrictions</label>
              <select id="armMovement">
                <option value="">Select...</option>
                <option value="compliant">Compliant - No reaching overhead</option>
                <option value="occasional">Occasional overhead reaching</option>
                <option value="frequent">Frequent overhead reaching</option>
                <option value="unrestricted">Unrestricted movement (too soon)</option>
              </select>
            </div>
          </div>
         
          <div class="form-grid cols-3" style="margin-top:12px">
            <div class="field">
              <label>Driving Status</label>
              <select id="drivingStatus">
                <option value="">Select...</option>
                <option value="not-driving">Not driving (compliant)</option>
                <option value="passenger">Passenger only</option>
                <option value="short-trips">Driving short trips (check clearance)</option>
                <option value="regular-driving">Regular driving (check clearance)</option>
              </select>
            </div>
            <div class="field">
              <label>Cough Splinting with Pillow</label>
              <select id="coughSplinting">
                <option value="">Select...</option>
                <option value="always">Always use pillow to splint</option>
                <option value="usually">Usually remember</option>
                <option value="sometimes">Sometimes forget</option>
                <option value="never">Not using pillow (risky)</option>
              </select>
            </div>
            <div class="field">
              <label>Felt Sternum "Give" or Shift Today</label>
              <select id="sternumShift">
                <option value="">Select...</option>
                <option value="no">No - sternum feels stable</option>
                <option value="minor">Minor sensation of movement</option>
                <option value="significant">Significant shifting (call doctor)</option>
              </select>
            </div>
          </div>
        </div>
        <!-- FUNCTIONAL ABILITIES (ADLs) -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">💪</span>
            <span>Functional Abilities Assessment (Activities of Daily Living)</span>
          </div>
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            Rate your ability to perform each activity independently (1 = Unable, 10 = No difficulty)
          </div>
         
          <div class="adl-item">
            <div class="adl-item-header">⬆️ Climbing Stairs (full flight without stopping)</div>
            <div class="adl-scale" data-adl="stairs"></div>
          </div>
         
          <div class="adl-item">
            <div class="adl-item-header">🚿 Showering Independently (washing, reaching, balance)</div>
            <div class="adl-scale" data-adl="showering"></div>
          </div>
         
          <div class="adl-item">
            <div class="adl-item-header">👔 Dressing Independently (buttons, socks, overhead)</div>
            <div class="adl-scale" data-adl="dressing"></div>
          </div>
         
          <div class="adl-item">
            <div class="adl-item-header">🍽️ Light Household Tasks (dishes, tidying)</div>
            <div class="adl-scale" data-adl="household"></div>
          </div>
         
          <div class="adl-item">
            <div class="adl-item-header">💼 Working at Desk (concentration, sitting upright)</div>
            <div class="adl-scale" data-adl="desk"></div>
          </div>
         
          <div class="adl-item">
            <div class="adl-item-header">🍳 Meal Preparation (standing, reaching, carrying)</div>
            <div class="adl-scale" data-adl="cooking"></div>
          </div>
         
          <div class="adl-item">
            <div class="adl-item-header">💇 Personal Grooming (brushing teeth/hair independently)</div>
            <div class="adl-scale" data-adl="grooming"></div>
          </div>
         
          <div class="adl-item">
            <div class="adl-item-header">🚶 Walking Around Home (room to room without SOB)</div>
            <div class="adl-scale" data-adl="walking"></div>
          </div>
         
          <div class="adl-item">
            <div class="adl-item-header">🛏️ Getting In/Out of Bed Independently</div>
            <div class="adl-scale" data-adl="bed"></div>
          </div>
        </div>
        <!-- FLUID MANAGEMENT -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">💧</span>
            <span>Fluid Management</span>
          </div>
          <div class="form-grid cols-3">
            <div class="field">
              <label>Daily Fluid Restriction (mL or oz)</label>
              <input type="number" id="fluidRestriction" placeholder="e.g., 2000 (2 liters)">
              <span class="helper-text">Your prescribed daily limit (if any)</span>
            </div>
            <div class="field">
              <label>Fluid Intake (mL or oz)</label>
              <input type="number" id="fluidIntake" placeholder="e.g., 1500">
              <span class="helper-text">Total for 24 hours</span>
            </div>
            <div class="field">
              <label>Fluid Balance Status</label>
              <input type="text" id="fluidBalance" placeholder="Auto-calculated" readonly style="background:rgba(255,255,255,0.02)">
              <span class="helper-text">Over/under restriction</span>
            </div>
          </div>
          <div class="form-grid cols-3" style="margin-top:12px">
            <div class="field">
              <label>Urine Output</label>
              <select id="urineOutput">
                <option value="">Select...</option>
                <option value="normal">Normal/adequate</option>
                <option value="decreased">Decreased</option>
                <option value="very-low">Very low</option>
                <option value="increased">Increased (frequent)</option>
              </select>
            </div>
            <div class="field">
              <label>Urine Color</label>
              <select id="urineColor">
                <option value="">Select...</option>
                <option value="pale-yellow">Pale yellow (well hydrated)</option>
                <option value="yellow">Yellow (normal)</option>
                <option value="dark-yellow">Dark yellow</option>
                <option value="amber">Amber/concentrated</option>
                <option value="abnormal">Abnormal color (red/brown)</option>
              </select>
            </div>
          </div>
        </div>
        <!-- MEDICATIONS WITH FREQUENCY -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">💊</span>
            <span>Medications Taken Today</span>
          </div>
          <div class="form-grid cols-2">
            <div class="field">
              <label>Diuretic (Furosemide/Lasix)</label>
              <div class="medication-row">
                <input type="text" id="diuretic" placeholder="e.g., 40mg">
                <input type="text" id="diureticFreq" placeholder="Times taken (e.g., 2x - 8am, 2pm)">
              </div>
            </div>
            <div class="field">
              <label>Anticoagulant (Warfarin/Eliquis/Xarelto)</label>
              <div class="medication-row">
                <input type="text" id="anticoagulant" placeholder="e.g., Warfarin 5mg">
                <input type="text" id="anticoagulantFreq" placeholder="Times taken (e.g., 1x - 6pm)">
              </div>
            </div>
            <div class="field">
              <label>Beta Blocker (Metoprolol/Carvedilol)</label>
              <div class="medication-row">
                <input type="text" id="betaBlocker" placeholder="e.g., Metoprolol 25mg">
                <input type="text" id="betaBlockerFreq" placeholder="Times taken (e.g., 2x - 8am, 8pm)">
              </div>
            </div>
            <div class="field">
              <label>Antiarrhythmic (Amiodarone/others)</label>
              <div class="medication-row">
                <input type="text" id="antiarrhythmic" placeholder="e.g., Amiodarone 200mg">
                <input type="text" id="antiarrhythmicFreq" placeholder="Times taken">
              </div>
            </div>
            <div class="field">
              <label>ACE Inhibitor / ARB</label>
              <div class="medication-row">
                <input type="text" id="aceInhibitor" placeholder="e.g., Lisinopril 10mg">
                <input type="text" id="aceInhibitorFreq" placeholder="Times taken">
              </div>
            </div>
            <div class="field">
              <label>Pain Medication</label>
              <div class="medication-row">
                <input type="text" id="painMed" placeholder="e.g., Tylenol 500mg">
                <input type="text" id="painMedFreq" placeholder="Times taken">
              </div>
            </div>
            <div class="field">
              <label>Potassium Supplement</label>
              <div class="medication-row">
                <input type="text" id="potassium" placeholder="e.g., K-Dur 20mEq">
                <input type="text" id="potassiumFreq" placeholder="Times taken">
              </div>
            </div>
            <div class="field">
              <label>Other Cardiac Meds</label>
              <div class="medication-row">
                <input type="text" id="otherCardiacMeds" placeholder="e.g., Spironolactone 25mg">
                <input type="text" id="otherCardiacMedsFreq" placeholder="Times taken">
              </div>
            </div>
          </div>
        </div>
        <!-- MEDICATION ADHERENCE TRACKING -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">✅</span>
            <span>Medication Adherence Tracking</span>
            <span class="new-feature-badge">SESSION 2</span>
          </div>
         
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            Track prescribed schedule vs actual doses taken. Click each dose slot to mark as taken or missed.
          </div>
          <div class="med-adherence-item">
            <div class="med-adherence-header">
              <span class="med-name">💊 Beta Blocker (Metoprolol/Carvedilol)</span>
              <span class="adherence-status" id="betaBlockerAdherenceStatus">Not Set</span>
            </div>
            <div class="form-grid cols-2" style="margin-bottom:10px">
              <div class="field">
                <label>Prescribed Schedule</label>
                <input type="text" id="betaBlockerSchedule" placeholder="e.g., 2x daily - 8am, 8pm">
              </div>
              <div class="field">
                <label>Number of Daily Doses</label>
                <input type="number" id="betaBlockerDoses" min="1" max="4" placeholder="e.g., 2" value="2">
              </div>
            </div>
            <div class="dose-tracker" id="betaBlockerDoseTracker"></div>
          </div>
          <div class="med-adherence-item">
            <div class="med-adherence-header">
              <span class="med-name">💧 Diuretic (Furosemide/Lasix)</span>
              <span class="adherence-status" id="diureticAdherenceStatus">Not Set</span>
            </div>
            <div class="form-grid cols-2" style="margin-bottom:10px">
              <div class="field">
                <label>Prescribed Schedule</label>
                <input type="text" id="diureticSchedule" placeholder="e.g., 2x daily - 8am, 2pm">
              </div>
              <div class="field">
                <label>Number of Daily Doses</label>
                <input type="number" id="diureticDoses" min="1" max="4" placeholder="e.g., 2" value="2">
              </div>
            </div>
            <div class="dose-tracker" id="diureticDoseTracker"></div>
          </div>
          <div class="med-adherence-item">
            <div class="med-adherence-header">
              <span class="med-name">🩸 Anticoagulant (Warfarin/Eliquis/Xarelto)</span>
              <span class="adherence-status" id="anticoagulantAdherenceStatus">Not Set</span>
            </div>
            <div class="form-grid cols-2" style="margin-bottom:10px">
              <div class="field">
                <label>Prescribed Schedule</label>
                <input type="text" id="anticoagulantSchedule" placeholder="e.g., 1x daily - 6pm">
              </div>
              <div class="field">
                <label>Number of Daily Doses</label>
                <input type="number" id="anticoagulantDoses" min="1" max="2" placeholder="e.g., 1" value="1">
              </div>
            </div>
            <div class="dose-tracker" id="anticoagulantDoseTracker"></div>
          </div>
          <div class="med-adherence-item">
            <div class="med-adherence-header">
              <span class="med-name">⚡ Antiarrhythmic (Amiodarone/others)</span>
              <span class="adherence-status" id="antiarrhythmicAdherenceStatus">Not Set</span>
            </div>
            <div class="form-grid cols-2" style="margin-bottom:10px">
              <div class="field">
                <label>Prescribed Schedule</label>
                <input type="text" id="antiarrhythmicSchedule" placeholder="e.g., 1x daily - 9am">
              </div>
              <div class="field">
                <label>Number of Daily Doses</label>
                <input type="number" id="antiarrhythmicDoses" min="1" max="3" placeholder="e.g., 1" value="1">
              </div>
            </div>
            <div class="dose-tracker" id="antiarrhythmicDoseTracker"></div>
          </div>
          <div class="field" style="margin-top:16px">
            <label>Reasons for Missed Doses (if any)</label>
            <textarea id="missedDoseReasons" placeholder="e.g., forgot morning dose, ran out of medication, experienced side effects..."></textarea>
          </div>
        </div>
        <!-- MEDICATION SIDE EFFECTS TRACKING -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">⚠️</span>
            <span>Medication Side Effects Tracking</span>
            <span class="new-feature-badge">SESSION 2</span>
          </div>
         
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            Track medication-specific side effects. Rate severity: None (0) → Mild (1) → Moderate (2) → Severe (3)
          </div>
          <div class="side-effect-tracker">
            <div class="side-effect-header">Amiodarone Side Effects</div>
            <div class="form-grid cols-2">
              <div class="field">
                <label>Thyroid Symptoms (fatigue, weight changes, palpitations)</label>
                <div class="severity-scale" data-effect="amio-thyroid">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Lung Symptoms (cough, SOB, wheezing)</label>
                <div class="severity-scale" data-effect="amio-lung">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Skin Changes (blue-gray discoloration, sun sensitivity)</label>
                <div class="severity-scale" data-effect="amio-skin">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Vision Changes (halos, blurred vision)</label>
                <div class="severity-scale" data-effect="amio-vision">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
            </div>
          </div>
          <div class="side-effect-tracker">
            <div class="side-effect-header">Beta Blocker Side Effects</div>
            <div class="form-grid cols-2">
              <div class="field">
                <label>Fatigue/Exercise Intolerance</label>
                <div class="severity-scale" data-effect="bb-fatigue">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Dizziness/Lightheadedness</label>
                <div class="severity-scale" data-effect="bb-dizziness">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Cold Hands/Feet</label>
                <div class="severity-scale" data-effect="bb-cold-extremities">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Depression/Mood Changes</label>
                <div class="severity-scale" data-effect="bb-mood">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
            </div>
          </div>
          <div class="side-effect-tracker">
            <div class="side-effect-header">Diuretic Side Effects</div>
            <div class="form-grid cols-2">
              <div class="field">
                <label>Frequent Urination/Urgency</label>
                <div class="severity-scale" data-effect="diuretic-urination">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Muscle Cramps</label>
                <div class="severity-scale" data-effect="diuretic-cramps">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Dizziness/Dehydration</label>
                <div class="severity-scale" data-effect="diuretic-dizziness">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Weakness/Fatigue</label>
                <div class="severity-scale" data-effect="diuretic-weakness">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
            </div>
          </div>
          <div class="side-effect-tracker">
            <div class="side-effect-header">Anticoagulant Side Effects (Warfarin/DOAC)</div>
            <div class="form-grid cols-2">
              <div class="field">
                <label>Easy Bruising</label>
                <div class="severity-scale" data-effect="anticoag-bruising">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Bleeding (gums, nosebleeds)</label>
                <div class="severity-scale" data-effect="anticoag-bleeding">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>GI Upset/Nausea</label>
                <div class="severity-scale" data-effect="anticoag-gi">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
              <div class="field">
                <label>Hair Loss (Warfarin)</label>
                <div class="severity-scale" data-effect="anticoag-hairloss">
                  <div class="severity-btn" data-value="0">None</div>
                  <div class="severity-btn" data-value="1">Mild</div>
                  <div class="severity-btn" data-value="2">Moderate</div>
                  <div class="severity-btn severe" data-value="3">Severe</div>
                </div>
              </div>
            </div>
          </div>
          <div class="field" style="margin-top:16px">
            <label>Other Side Effects or Concerns</label>
            <textarea id="otherSideEffects" placeholder="Describe any other medication side effects you're experiencing..."></textarea>
          </div>
        </div>
        <!-- VITAMIN K INTAKE TRACKING -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🥬</span>
            <span>Vitamin K Intake Tracking (Critical for Warfarin Patients)</span>
            <span class="new-feature-badge">SESSION 2</span>
          </div>
         
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            If you take Warfarin, track your Vitamin K intake. Consistency is key - sudden increases or decreases affect INR. Mark foods consumed today.
          </div>
          <div style="background:rgba(239,68,68,0.1);border:1px solid rgba(239,68,68,0.3);border-radius:8px;padding:12px;margin-bottom:16px">
            <strong>⚠️ For Warfarin Patients:</strong> Don't avoid Vitamin K foods completely - maintain CONSISTENT intake. Sudden changes (eating lots of greens one day, none the next) destabilize your INR.
          </div>
          <div class="form-grid cols-2">
            <div class="field">
              <label>Currently Taking Warfarin?</label>
              <select id="onWarfarin">
                <option value="">Select...</option>
                <option value="yes">Yes - actively taking Warfarin</option>
                <option value="no">No - on different anticoagulant</option>
                <option value="not-anticoag">No anticoagulant</option>
              </select>
            </div>
            <div class="field">
              <label>Dietary Vitamin K Consistency</label>
              <select id="vitaminKConsistency">
                <option value="">Select...</option>
                <option value="consistent">Consistent - eat similar amounts daily</option>
                <option value="variable">Variable - intake changes day to day</option>
                <option value="increased">Significantly increased today</option>
                <option value="decreased">Significantly decreased today</option>
              </select>
            </div>
          </div>
          <div style="margin-top:16px;margin-bottom:12px;font-weight:600;color:var(--cyan)">Foods Consumed Today (Check all that apply)</div>
          <div style="margin-bottom:16px">
            <div style="font-weight:600;color:var(--warn);margin-bottom:8px">🔴 Very High Vitamin K (>200 mcg per serving)</div>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="kale" data-level="high">
                <span>Kale (530 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="spinach" data-level="high">
                <span>Spinach (145-888 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="collard-greens" data-level="high">
                <span>Collard Greens (836 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="turnip-greens" data-level="high">
                <span>Turnip Greens (529 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="mustard-greens" data-level="high">
                <span>Mustard Greens (419 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="swiss-chard" data-level="high">
                <span>Swiss Chard (299 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="parsley" data-level="high">
                <span>Parsley (246 mcg/1/4 cup)</span>
              </label>
            </div>
          </div>
          <div style="margin-bottom:16px">
            <div style="font-weight:600;color:var(--warn);margin-bottom:8px">🟡 High Vitamin K (50-200 mcg per serving)</div>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="broccoli" data-level="moderate">
                <span>Broccoli (220 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="brussels-sprouts" data-level="moderate">
                <span>Brussels Sprouts (218 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="cabbage" data-level="moderate">
                <span>Cabbage (163 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="asparagus" data-level="moderate">
                <span>Asparagus (91 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="lettuce-romaine" data-level="moderate">
                <span>Romaine Lettuce (57 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="green-beans" data-level="moderate">
                <span>Green Beans (60 mcg/cup)</span>
              </label>
            </div>
          </div>
          <div style="margin-bottom:16px">
            <div style="font-weight:600;color:var(--good);margin-bottom:8px">🟢 Moderate Vitamin K (15-50 mcg per serving)</div>
            <div class="checkbox-group">
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="lettuce-iceberg" data-level="low">
                <span>Iceberg Lettuce (17 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="celery" data-level="low">
                <span>Celery (30 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="peas" data-level="low">
                <span>Peas (41 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="kiwi" data-level="low">
                <span>Kiwi (28 mcg/fruit)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="blueberries" data-level="low">
                <span>Blueberries (29 mcg/cup)</span>
              </label>
              <label class="checkbox-item">
                <input type="checkbox" name="vitaminK" value="avocado" data-level="low">
                <span>Avocado (21 mcg/half)</span>
              </label>
            </div>
          </div>
          <div class="field">
            <label>Servings of High Vitamin K Foods Today</label>
            <input type="number" id="vitaminKServings" min="0" placeholder="e.g., 2">
            <span class="helper-text">Total servings of all high/very high Vitamin K foods</span>
          </div>
          <div class="field" style="margin-top:12px">
            <label>Vitamin K Supplement Use</label>
            <select id="vitaminKSupplement">
              <option value="">Select...</option>
              <option value="none">None</option>
              <option value="multivitamin">Multivitamin (contains Vitamin K)</option>
              <option value="vitamin-k-supplement">Vitamin K supplement (DANGEROUS with Warfarin!)</option>
              <option value="green-powder">Green powder/smoothie supplement</option>
            </select>
          </div>
          <div class="field" style="margin-top:12px">
            <label>Notes on Diet Changes or Vitamin K Intake</label>
            <textarea id="vitaminKNotes" placeholder="e.g., Started new diet, ate more salads than usual, avoiding greens lately..."></textarea>
          </div>
        </div>
        <!-- NEW SESSION 3 FEATURE: ANTICOAGULATION MANAGEMENT -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🩸</span>
            <span>Anticoagulation Management (Warfarin)</span>
            <span class="new-feature-badge">SESSION 3</span>
          </div>
         
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            Track Warfarin dose changes and INR results over time. This creates a historical record for you and your providers.
          </div>
          <div class="form-grid cols-3">
            <div class="field">
              <label>INR Managing Provider</label>
              <select id="inrProvider">
                <option value="">Select...</option>
                <option value="cardiologist">Cardiologist</option>
                <option value="pcp">Primary Care Physician</option>
                <option value="anticoag-clinic">Anticoagulation Clinic</option>
                <option value="cardiac-surgeon">Cardiac Surgeon</option>
                <option value="other">Other Specialist</option>
              </select>
            </div>
            <div class="field">
              <label>Provider Name/Clinic</label>
              <input type="text" id="inrProviderName" placeholder="e.g., Dr. Smith, City Anticoag Clinic">
            </div>
            <div class="field">
              <label>Provider Phone</label>
              <input type="tel" id="inrProviderPhone" placeholder="e.g., (555) 123-4567">
            </div>
          </div>
          <div style="margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.06)">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Today's INR & Warfarin Dose</div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Today's INR Result</label>
                <input type="number" id="todayINR" step="0.1" min="0" max="10" placeholder="e.g., 2.5">
                <span class="helper-text">Target: 2.0-3.0 (most valve patients)</span>
              </div>
              <div class="field">
                <label>Current Warfarin Daily Dose (mg)</label>
                <input type="number" id="todayWarfarinDose" step="0.5" min="0" max="20" placeholder="e.g., 5">
              </div>
              <div class="field">
                <label>Dose Change Instructions</label>
                <select id="warfarinDoseChange">
                  <option value="">Select...</option>
                  <option value="no-change">No change - continue same dose</option>
                  <option value="increase">Increase dose</option>
                  <option value="decrease">Decrease dose</option>
                  <option value="hold-1-day">Hold 1 day, then restart</option>
                  <option value="hold-2-days">Hold 2 days, then restart</option>
                  <option value="complex">Complex dosing schedule</option>
                </select>
              </div>
            </div>
            <div class="field" style="margin-top:12px">
              <label>New Dose Instructions (if changed)</label>
              <textarea id="warfarinNewDoseInstructions" placeholder="e.g., Take 5mg Mon/Wed/Fri/Sun, 7.5mg Tue/Thu/Sat..."></textarea>
            </div>
          </div>
          <div style="margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.06)">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Next INR Check Schedule</div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Next INR Date</label>
                <input type="date" id="nextINRDate">
              </div>
              <div class="field">
                <label>Check Location</label>
                <select id="nextINRLocation">
                  <option value="">Select...</option>
                  <option value="clinic">Clinic/Office</option>
                  <option value="lab">Independent Lab</option>
                  <option value="home-monitor">Home INR Monitor</option>
                  <option value="hospital">Hospital Lab</option>
                </select>
              </div>
              <div class="field">
                <label>Appointment Time</label>
                <input type="time" id="nextINRTime">
              </div>
            </div>
          </div>
          <div style="margin-top:20px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.06)">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
              <div style="font-weight:600;color:var(--cyan)">Recent INR History</div>
              <button type="button" id="addINRHistory" style="padding:6px 12px;font-size:0.85rem">+ Add Past INR</button>
            </div>
            <div id="inrHistoryContainer"></div>
          </div>
          <div class="field" style="margin-top:16px">
            <label>Anticoagulation Notes</label>
            <textarea id="anticoagNotes" placeholder="e.g., Dietary changes, missed doses, bleeding events, bruising..."></textarea>
          </div>
        </div>
        <!-- LAB VALUES - EXPANDED -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🧪</span>
            <span>Lab Values (if checked today)</span>
          </div>
          <div class="form-grid cols-4">
            <div class="field">
              <label>INR (Warfarin monitoring)</label>
              <input type="number" id="inr" step="0.1" min="0" max="10" placeholder="e.g., 2.5">
              <span class="helper-text">Target: 2.0-3.0</span>
            </div>
            <div class="field">
              <label>Potassium (K+)</label>
              <input type="number" id="potassiumLevel" step="0.1" min="0" max="10" placeholder="e.g., 4.2">
              <span class="helper-text">Normal: 3.5-5.0</span>
            </div>
            <div class="field">
              <label>Magnesium (Mg)</label>
              <input type="number" id="magnesiumLevel" step="0.1" min="0" max="5" placeholder="e.g., 2.0">
              <span class="helper-text">Normal: 1.7-2.2</span>
            </div>
            <div class="field">
              <label>BNP/NT-proBNP</label>
              <input type="number" id="bnp" placeholder="e.g., 450">
              <span class="helper-text">Heart failure marker</span>
            </div>
            <div class="field">
              <label>Creatinine (kidney)</label>
              <input type="number" id="creatinine" step="0.01" placeholder="e.g., 1.1">
              <span class="helper-text">Normal: 0.6-1.2</span>
            </div>
            <div class="field">
              <label>Hemoglobin (Hgb)</label>
              <input type="number" id="hemoglobin" step="0.1" placeholder="e.g., 12.5">
              <span class="helper-text">Normal: 12-16 g/dL</span>
            </div>
            <div class="field">
              <label>RBC (Red Blood Cells)</label>
              <input type="number" id="rbc" step="0.1" placeholder="e.g., 4.5">
              <span class="helper-text">Normal: 4.0-5.5 M/μL</span>
            </div>
            <div class="field">
              <label>WBC (White Blood Cells)</label>
              <input type="number" id="wbc" step="0.1" placeholder="e.g., 7.5">
              <span class="helper-text">Normal: 4.5-11.0 K/μL</span>
            </div>
            <div class="field">
              <label>Next Lab Date</label>
              <input type="date" id="nextLabDate">
            </div>
          </div>
        </div>
        <!-- ACTIVITY WITH WALKING SESSIONS -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🚶</span>
            <span>Activity & Exercise</span>
          </div>
         
          <div class="field" style="margin-bottom:16px">
            <label>Walking Sessions Today</label>
            <div id="walkingSessionsContainer"></div>
            <button type="button" class="add-session-btn" id="addWalkingSession">+ Add Walking Session</button>
          </div>
         
          <div class="form-grid cols-3">
            <div class="field">
              <label>Total Steps Today</label>
              <input type="number" id="steps" placeholder="e.g., 2500">
            </div>
            <div class="field">
              <label>Cardiac Rehab Session</label>
              <select id="cardiacRehab">
                <option value="">Select...</option>
                <option value="no">Not today</option>
                <option value="yes-completed">Yes - completed</option>
                <option value="yes-partial">Yes - partial</option>
                <option value="cancelled">Cancelled</option>
              </select>
            </div>
            <div class="field">
              <label>Activity Tolerance</label>
              <select id="activityTolerance">
                <option value="">Select...</option>
                <option value="excellent">Excellent - no limitations</option>
                <option value="good">Good - minor limitations</option>
                <option value="fair">Fair - moderate limitations</option>
                <option value="poor">Poor - severe limitations</option>
                <option value="bedbound">Mostly bedbound</option>
              </select>
            </div>
            <div class="field">
              <label>Stairs Climbed Today</label>
              <input type="number" id="stairs" placeholder="Number of flights">
            </div>
            <div class="field">
              <label>Exercise-Related SOB</label>
              <select id="exerciseSOB">
                <option value="">Select...</option>
                <option value="none">None</option>
                <option value="mild">Mild - expected</option>
                <option value="moderate">Moderate - concerning</option>
                <option value="severe">Severe - stopped activity</option>
              </select>
            </div>
          </div>
        </div>
        <!-- NEW SESSION 3 FEATURE: EXERCISE PRESCRIPTION VS ACTUAL -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🏃</span>
            <span>Exercise Prescription vs Actual Performance</span>
            <span class="new-feature-badge">SESSION 3</span>
          </div>
         
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            Compare your cardiac rehab targets with what you actually achieved. Track progress over time.
          </div>
          <div class="exercise-comparison">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Walking Distance</div>
            <div class="exercise-metric">
              <span class="exercise-metric-name">Distance</span>
              <div class="exercise-values">
                <div class="exercise-value">
                  <div class="exercise-value-label">Target</div>
                  <input type="number" id="walkTargetDistance" step="0.1" placeholder="e.g., 1.5" style="width:80px;text-align:center;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:1rem;font-weight:700">
                  <div style="font-size:0.75rem;color:var(--muted);margin-top:2px">miles/km</div>
                </div>
                <div class="exercise-value">
                  <div class="exercise-value-label">Achieved</div>
                  <input type="number" id="walkActualDistance" step="0.1" placeholder="e.g., 1.2" style="width:80px;text-align:center;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:1rem;font-weight:700">
                  <div style="font-size:0.75rem;color:var(--muted);margin-top:2px">miles/km</div>
                </div>
                <div class="exercise-achievement" id="walkDistanceStatus">--</div>
              </div>
            </div>
          </div>
          <div class="exercise-comparison">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Exercise Duration</div>
            <div class="exercise-metric">
              <span class="exercise-metric-name">Duration</span>
              <div class="exercise-values">
                <div class="exercise-value">
                  <div class="exercise-value-label">Target</div>
                  <input type="number" id="exerciseTargetDuration" placeholder="e.g., 30" style="width:80px;text-align:center;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:1rem;font-weight:700">
                  <div style="font-size:0.75rem;color:var(--muted);margin-top:2px">minutes</div>
                </div>
                <div class="exercise-value">
                  <div class="exercise-value-label">Achieved</div>
                  <input type="number" id="exerciseActualDuration" placeholder="e.g., 25" style="width:80px;text-align:center;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:1rem;font-weight:700">
                  <div style="font-size:0.75rem;color:var(--muted);margin-top:2px">minutes</div>
                </div>
                <div class="exercise-achievement" id="exerciseDurationStatus">--</div>
              </div>
            </div>
          </div>
          <div class="exercise-comparison">
            <div style="font-weight:600;color:var(--cyan);margin-bottom:12px">Heart Rate During Exercise</div>
            <div class="exercise-metric">
              <span class="exercise-metric-name">Average HR</span>
              <div class="exercise-values">
                <div class="exercise-value">
                  <div class="exercise-value-label">Target Zone</div>
                  <input type="text" id="exerciseTargetHR" placeholder="e.g., 90-110" style="width:100px;text-align:center;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:0.95rem;font-weight:700">
                  <div style="font-size:0.75rem;color:var(--muted);margin-top:2px">bpm range</div>
                </div>
                <div class="exercise-value">
                  <div class="exercise-value-label">Actual Avg</div>
                  <input type="number" id="exerciseActualHR" placeholder="e.g., 105" style="width:80px;text-align:center;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:1rem;font-weight:700">
                  <div style="font-size:0.75rem;color:var(--muted);margin-top:2px">bpm</div>
                </div>
                <div class="exercise-achievement" id="exerciseHRStatus">--</div>
              </div>
            </div>
            <div class="exercise-metric">
              <span class="exercise-metric-name">Peak HR</span>
              <div class="exercise-values">
                <div class="exercise-value">
                  <div class="exercise-value-label">Max Allowed</div>
                  <input type="number" id="exerciseMaxHR" placeholder="e.g., 120" style="width:80px;text-align:center;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:1rem;font-weight:700">
                  <div style="font-size:0.75rem;color:var(--muted);margin-top:2px">bpm</div>
                </div>
                <div class="exercise-value">
                  <div class="exercise-value-label">Peak Reached</div>
                  <input type="number" id="exercisePeakHR" placeholder="e.g., 115" style="width:80px;text-align:center;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:1rem;font-weight:700">
                  <div style="font-size:0.75rem;color:var(--muted);margin-top:2px">bpm</div>
                </div>
                <div class="exercise-achievement" id="exercisePeakHRStatus">--</div>
              </div>
            </div>
          </div>
          <div class="field" style="margin-top:16px">
            <label>Exercise Notes & Adjustments</label>
            <textarea id="exerciseNotes" placeholder="e.g., Stopped early due to fatigue, felt stronger today, therapist increased resistance..."></textarea>
          </div>
          <div style="margin-top:16px;padding:12px;background:rgba(96,165,250,0.1);border:1px solid rgba(96,165,250,0.3);border-radius:8px">
            <div style="font-weight:600;margin-bottom:8px">Rehab Therapist Instructions:</div>
            <div class="form-grid cols-2">
              <div class="field">
                <label>Next Session Date</label>
                <input type="date" id="nextRehabDate">
              </div>
              <div class="field">
                <label>Frequency Per Week</label>
                <input type="number" id="rehabFrequency" min="1" max="7" placeholder="e.g., 3">
              </div>
            </div>
          </div>
        </div>
        <!-- MENSTRUAL CYCLE TRACKING -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🌸</span>
            <span>Menstrual Cycle Tracking</span>
          </div>
          <div class="form-grid cols-3">
            <div class="field">
              <label>Cycle Status</label>
              <select id="cycleStatus">
                <option value="">Select...</option>
                <option value="before">Before period (Follicular phase)</option>
                <option value="during">During period (Menstruation)</option>
                <option value="after">After period (Luteal phase)</option>
                <option value="ovulation">Ovulation</option>
                <option value="not-applicable">Not applicable</option>
              </select>
            </div>
            <div class="field">
              <label>Cycle Day</label>
              <input type="number" id="cycleDay" min="1" max="45" placeholder="Day 1-28+">
              <span class="helper-text">Day 1 = first day of period</span>
            </div>
            <div class="field">
              <label>Days Until/Since Period</label>
              <input type="text" id="daysRelativeToPeriod" placeholder="e.g., 5 days before, 2 days after">
            </div>
          </div>
          <div class="form-grid cols-2" style="margin-top:12px">
            <div class="field">
              <label>Flow Heaviness (if during period)</label>
              <select id="flowHeaviness">
                <option value="">Select...</option>
                <option value="spotting">Spotting</option>
                <option value="light">Light</option>
                <option value="moderate">Moderate</option>
                <option value="heavy">Heavy</option>
                <option value="very-heavy">Very heavy (concerning)</option>
              </select>
            </div>
            <div class="field">
              <label>Hormonal Symptoms</label>
              <input type="text" id="hormonalSymptoms" placeholder="e.g., cramps, bloating, mood changes">
            </div>
          </div>
        </div>
        <!-- PATIENT WELLBEING ASSESSMENT -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">😊</span>
            <span>Patient Well-Being Self-Assessment</span>
          </div>
          <div class="field" style="margin-bottom:16px">
            <label>Overall Well-Being Score (1 = Terrible, 10 = Excellent)</label>
            <div class="wellbeing-scale" id="wellbeingScale"></div>
          </div>
          <div class="field">
            <label>How I'm Feeling Today (Brief Summary)</label>
            <textarea id="wellbeingSummary" placeholder="Describe how you're feeling overall, any concerns, wins, or observations about your recovery today..."></textarea>
          </div>
        </div>
        <!-- NEW SESSION 3 FEATURE: DEPRESSION SCREENING (PHQ-9) -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">🧠</span>
            <span>Depression Screening (PHQ-9)</span>
            <span class="new-feature-badge">SESSION 3</span>
          </div>
         
          <div style="background:rgba(96,165,250,0.1);border:1px solid rgba(96,165,250,0.3);border-radius:8px;padding:16px;margin-bottom:16px">
            <div style="font-weight:700;margin-bottom:8px">About This Screening:</div>
            <div style="color:var(--muted);font-size:0.9rem;line-height:1.6">
              The PHQ-9 is a validated screening tool for depression. This is NOT a diagnosis - it's a way to monitor your emotional health during recovery. Depression is common after cardiac surgery and can affect your recovery. Answer honestly about how you've felt <strong>over the last 2 weeks</strong>. Share results with your healthcare provider.
            </div>
          </div>
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            <strong>Over the last 2 weeks, how often have you been bothered by the following problems?</strong>
          </div>
          <div class="phq9-question">
            <div class="phq9-question-text">1. Little interest or pleasure in doing things</div>
            <div class="phq9-options" data-question="q1">
              <div class="phq9-option" data-value="0">Not at all (0)</div>
              <div class="phq9-option" data-value="1">Several days (1)</div>
              <div class="phq9-option" data-value="2">More than half the days (2)</div>
              <div class="phq9-option" data-value="3">Nearly every day (3)</div>
            </div>
          </div>
          <div class="phq9-question">
            <div class="phq9-question-text">2. Feeling down, depressed, or hopeless</div>
            <div class="phq9-options" data-question="q2">
              <div class="phq9-option" data-value="0">Not at all (0)</div>
              <div class="phq9-option" data-value="1">Several days (1)</div>
              <div class="phq9-option" data-value="2">More than half the days (2)</div>
              <div class="phq9-option" data-value="3">Nearly every day (3)</div>
            </div>
          </div>
          <div class="phq9-question">
            <div class="phq9-question-text">3. Trouble falling or staying asleep, or sleeping too much</div>
            <div class="phq9-options" data-question="q3">
              <div class="phq9-option" data-value="0">Not at all (0)</div>
              <div class="phq9-option" data-value="1">Several days (1)</div>
              <div class="phq9-option" data-value="2">More than half the days (2)</div>
              <div class="phq9-option" data-value="3">Nearly every day (3)</div>
            </div>
          </div>
          <div class="phq9-question">
            <div class="phq9-question-text">4. Feeling tired or having little energy</div>
            <div class="phq9-options" data-question="q4">
              <div class="phq9-option" data-value="0">Not at all (0)</div>
              <div class="phq9-option" data-value="1">Several days (1)</div>
              <div class="phq9-option" data-value="2">More than half the days (2)</div>
              <div class="phq9-option" data-value="3">Nearly every day (3)</div>
            </div>
          </div>
          <div class="phq9-question">
            <div class="phq9-question-text">5. Poor appetite or overeating</div>
            <div class="phq9-options" data-question="q5">
              <div class="phq9-option" data-value="0">Not at all (0)</div>
              <div class="phq9-option" data-value="1">Several days (1)</div>
              <div class="phq9-option" data-value="2">More than half the days (2)</div>
              <div class="phq9-option" data-value="3">Nearly every day (3)</div>
            </div>
          </div>
          <div class="phq9-question">
            <div class="phq9-question-text">6. Feeling bad about yourself - or that you are a failure or have let yourself or your family down</div>
            <div class="phq9-options" data-question="q6">
              <div class="phq9-option" data-value="0">Not at all (0)</div>
              <div class="phq9-option" data-value="1">Several days (1)</div>
              <div class="phq9-option" data-value="2">More than half the days (2)</div>
              <div class="phq9-option" data-value="3">Nearly every day (3)</div>
            </div>
          </div>
          <div class="phq9-question">
            <div class="phq9-question-text">7. Trouble concentrating on things, such as reading the newspaper or watching television</div>
            <div class="phq9-options" data-question="q7">
              <div class="phq9-option" data-value="0">Not at all (0)</div>
              <div class="phq9-option" data-value="1">Several days (1)</div>
              <div class="phq9-option" data-value="2">More than half the days (2)</div>
              <div class="phq9-option" data-value="3">Nearly every day (3)</div>
            </div>
          </div>
          <div class="phq9-question">
            <div class="phq9-question-text">8. Moving or speaking so slowly that other people could have noticed. Or the opposite - being so fidgety or restless that you have been moving around a lot more than usual</div>
            <div class="phq9-options" data-question="q8">
              <div class="phq9-option" data-value="0">Not at all (0)</div>
              <div class="phq9-option" data-value="1">Several days (1)</div>
              <div class="phq9-option" data-value="2">More than half the days (2)</div>
              <div class="phq9-option" data-value="3">Nearly every day (3)</div>
            </div>
          </div>
          <div class="phq9-question">
            <div class="phq9-question-text">9. Thoughts that you would be better off dead, or of hurting yourself in some way</div>
            <div class="phq9-options" data-question="q9">
              <div class="phq9-option" data-value="0">Not at all (0)</div>
              <div class="phq9-option" data-value="1">Several days (1)</div>
              <div class="phq9-option" data-value="2">More than half the days (2)</div>
              <div class="phq9-option" data-value="3">Nearly every day (3)</div>
            </div>
          </div>
          <div class="phq9-score-display" id="phq9ScoreDisplay" style="display:none">
            <div>
              <div class="phq9-score-number" id="phq9Score">0</div>
              <div class="phq9-score-severity" id="phq9Severity">Not scored</div>
            </div>
          </div>
          <div id="phq9CrisisBox" style="display:none" class="phq9-crisis-box">
            <div class="phq9-crisis-title">🚨 IMMEDIATE HELP AVAILABLE 🚨</div>
            <div style="font-size:1rem;margin-bottom:12px">
              You indicated thoughts of self-harm. <strong>Please reach out for help right now.</strong>
            </div>
            <div class="phq9-crisis-number">
              Call or Text 988
            </div>
            <div style="font-size:0.9rem;margin-top:12px">
              <strong>988 Suicide & Crisis Lifeline</strong><br>
              Available 24/7 • Free & Confidential<br>
              You can also chat online at <strong>988lifeline.org</strong>
            </div>
            <div style="margin-top:16px;padding-top:16px;border-top:1px solid rgba(255,255,255,0.2)">
              <strong>Other Crisis Resources:</strong><br>
              • Crisis Text Line: Text HOME to 741741<br>
              • Veterans Crisis Line: Call 988, Press 1<br>
              • Emergency: Call 911
            </div>
          </div>
          <div style="background:rgba(96,165,250,0.1);border:1px solid rgba(96,165,250,0.3);border-radius:8px;padding:12px;margin-top:16px;font-size:0.85rem;color:var(--muted)">
            <strong>Important:</strong> This screening tool helps identify symptoms but is NOT a diagnosis. Depression is treatable. If your score indicates depression symptoms, please discuss results with your doctor, therapist, or mental health provider. Cardiac surgery patients commonly experience depression, and treatment can significantly improve your recovery and quality of life.
          </div>
        </div>
        <!-- NEW SESSION 3 FEATURE: PROVIDER CONTACT LOG -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">👨‍⚕️</span>
            <span>Provider Contact Log & Follow-Up Schedule</span>
            <span class="new-feature-badge">SESSION 3</span>
          </div>
         
          <div style="color:var(--muted);font-size:0.9rem;margin-bottom:16px">
            Track your healthcare team contacts and upcoming appointments. System alerts for overdue follow-ups.
          </div>
          <div class="provider-card">
            <div class="provider-header">
              <span class="provider-name">🩺 Primary Care Physician (PCP)</span>
              <span class="provider-status current" id="pcpStatus">Current</span>
            </div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Provider Name</label>
                <input type="text" id="pcpName" placeholder="Dr. Smith">
              </div>
              <div class="field">
                <label>Office Phone</label>
                <input type="tel" id="pcpPhone" placeholder="(555) 123-4567">
              </div>
              <div class="field">
                <label>Last Contact Date</label>
                <input type="date" id="pcpLastContact">
              </div>
            </div>
            <div class="form-grid cols-2" style="margin-top:8px">
              <div class="field">
                <label>Next Scheduled Appointment</label>
                <input type="date" id="pcpNextAppt">
              </div>
              <div class="field">
                <label>Recommended Follow-Up Interval</label>
                <select id="pcpInterval">
                  <option value="">Select...</option>
                  <option value="1-week">1 week</option>
                  <option value="2-weeks">2 weeks</option>
                  <option value="1-month">1 month</option>
                  <option value="3-months">3 months</option>
                  <option value="6-months">6 months</option>
                  <option value="annual">Annual</option>
                </select>
              </div>
            </div>
          </div>
          <div class="provider-card">
            <div class="provider-header">
              <span class="provider-name">❤️ Cardiologist</span>
              <span class="provider-status current" id="cardioStatus">Current</span>
            </div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Provider Name</label>
                <input type="text" id="cardioName" placeholder="Dr. Johnson">
              </div>
              <div class="field">
                <label>Office Phone</label>
                <input type="tel" id="cardioPhone" placeholder="(555) 234-5678">
              </div>
              <div class="field">
                <label>Last Contact Date</label>
                <input type="date" id="cardioLastContact">
              </div>
            </div>
            <div class="form-grid cols-2" style="margin-top:8px">
              <div class="field">
                <label>Next Scheduled Appointment</label>
                <input type="date" id="cardioNextAppt">
              </div>
              <div class="field">
                <label>Recommended Follow-Up Interval</label>
                <select id="cardioInterval">
                  <option value="">Select...</option>
                  <option value="1-week">1 week</option>
                  <option value="2-weeks">2 weeks</option>
                  <option value="1-month">1 month</option>
                  <option value="6-weeks">6 weeks</option>
                  <option value="3-months">3 months</option>
                  <option value="6-months">6 months</option>
                </select>
              </div>
            </div>
          </div>
          <div class="provider-card">
            <div class="provider-header">
              <span class="provider-name">🔪 Cardiac Surgeon</span>
              <span class="provider-status current" id="surgeonStatus">Current</span>
            </div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Provider Name</label>
                <input type="text" id="surgeonName" placeholder="Dr. Williams">
              </div>
              <div class="field">
                <label>Office Phone</label>
                <input type="tel" id="surgeonPhone" placeholder="(555) 345-6789">
              </div>
              <div class="field">
                <label>Last Contact Date</label>
                <input type="date" id="surgeonLastContact">
              </div>
            </div>
            <div class="form-grid cols-2" style="margin-top:8px">
              <div class="field">
                <label>Next Scheduled Appointment</label>
                <input type="date" id="surgeonNextAppt">
              </div>
              <div class="field">
                <label>Recommended Follow-Up Interval</label>
                <select id="surgeonInterval">
                  <option value="">Select...</option>
                  <option value="2-weeks">2 weeks</option>
                  <option value="6-weeks">6 weeks</option>
                  <option value="3-months">3 months</option>
                  <option value="6-months">6 months</option>
                  <option value="annual">Annual</option>
                </select>
              </div>
            </div>
          </div>
          <div class="provider-card">
            <div class="provider-header">
              <span class="provider-name">⚡ Electrophysiologist (EP)</span>
              <span class="provider-status current" id="epStatus">Current</span>
            </div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Provider Name</label>
                <input type="text" id="epName" placeholder="Dr. Brown">
              </div>
              <div class="field">
                <label>Office Phone</label>
                <input type="tel" id="epPhone" placeholder="(555) 456-7890">
              </div>
              <div class="field">
                <label>Last Contact Date</label>
                <input type="date" id="epLastContact">
              </div>
            </div>
            <div class="form-grid cols-2" style="margin-top:8px">
              <div class="field">
                <label>Next Scheduled Appointment</label>
                <input type="date" id="epNextAppt">
              </div>
              <div class="field">
                <label>Recommended Follow-Up Interval</label>
                <select id="epInterval">
                  <option value="">Select...</option>
                  <option value="3-months">3 months (pacemaker check)</option>
                  <option value="6-months">6 months</option>
                  <option value="annual">Annual</option>
                </select>
              </div>
            </div>
          </div>
          <div class="provider-card">
            <div class="provider-header">
              <span class="provider-name">💪 Cardiac Rehab</span>
              <span class="provider-status current" id="rehabStatus">Current</span>
            </div>
            <div class="form-grid cols-3">
              <div class="field">
                <label>Facility/Therapist Name</label>
                <input type="text" id="rehabName" placeholder="City Cardiac Rehab Center">
              </div>
              <div class="field">
                <label>Phone</label>
                <input type="tel" id="rehabPhone" placeholder="(555) 567-8901">
              </div>
              <div class="field">
                <label>Last Session Date</label>
                <input type="date" id="rehabLastSession">
              </div>
            </div>
            <div class="form-grid cols-2" style="margin-top:8px">
              <div class="field">
                <label>Sessions Per Week</label>
                <input type="number" id="rehabSessionsPerWeek" min="1" max="7" placeholder="e.g., 3">
              </div>
              <div class="field">
                <label>Total Sessions Prescribed</label>
                <input type="number" id="rehabTotalSessions" placeholder="e.g., 36">
              </div>
            </div>
            <div class="field" style="margin-top:8px">
              <label>Sessions Completed</label>
              <input type="number" id="rehabCompletedSessions" placeholder="e.g., 12">
            </div>
          </div>
          <div id="overdueApptAlert" style="display:none;background:rgba(239,68,68,0.15);border:2px solid var(--bad);border-radius:10px;padding:16px;margin-top:16px;font-weight:600">
            ⚠️ OVERDUE FOLLOW-UP: You have one or more overdue appointments or follow-ups. Please contact your providers to schedule.
          </div>
        </div>
        <!-- ADDITIONAL SYMPTOMS TO REPORT -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">⚠️</span>
            <span>Critical Warning Symptoms (Check all that apply)</span>
          </div>
          <div class="checkbox-group">
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="chest-pressure">
              <span>New chest pressure/pain</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="jaw-pain">
              <span>Jaw or arm pain</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="cold-sweats">
              <span>Cold sweats</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="confusion">
              <span>Confusion/disorientation</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="vision-changes">
              <span>Vision changes</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="speech-difficulty">
              <span>Speech difficulty</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="weakness">
              <span>One-sided weakness</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="rapid-weight-gain">
              <span>Rapid weight gain (2+ lbs/day)</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="fever">
              <span>Fever over 100.4°F</span>
            </label>
            <label class="checkbox-item">
              <input type="checkbox" name="symptom" value="bleeding">
              <span>Unusual bleeding/bruising</span>
            </label>
          </div>
        </div>
        <!-- NOTES -->
        <div class="section">
          <div class="section-header">
            <span class="section-icon">📝</span>
            <span>Additional Notes & Observations</span>
          </div>
          <div class="field">
            <label>Daily notes, concerns, questions for doctor</label>
            <textarea id="notes" placeholder="Any other observations, questions for next appointment, things to discuss with care team..."></textarea>
          </div>
        </div>
        <div class="submit-section">
          <button type="button" id="clearForm">Clear Form</button>
          <button type="submit" class="btn-primary">💾 Save Entry</button>
        </div>
      </form>
    </div>
    <div class="history">
      <div class="history-header">
        <h2>📊 Recovery History & Assessment</h2>
        <button id="clearHistory">Clear All History</button>
      </div>
      <div class="entries" id="entriesContainer">
        <div class="empty-state">
          <p style="font-size:3rem;margin-bottom:12px">💓</p>
          <p>No entries yet. Create your first entry above!</p>
        </div>
      </div>
    </div>
    <div class="footer-brand">
      <div class="heart-icon" style="font-size:2rem;margin-bottom:8px">💓</div>
      <div class="brand-name">HEARTBEAT™</div>
      <div class="brand-tagline">Healing Evaluation & Assessment for Recovery Tracking</div>
      <div style="margin-top:12px;font-size:0.9rem">
        Powered by <strong style="color:var(--pink)">John E. Desautels & Associates</strong>
      </div>
      <div style="margin-top:8px;font-size:0.8rem;color:#6b7280">
        Advanced Cardiac Recovery Analytics & Patient Monitoring Solutions
      </div>
      <div style="margin-top:16px;font-size:0.85rem;color:var(--cyan);font-weight:600">
        ✨ Session 4 Enhanced: Pain Trends • Real-Time Validation • Pacemaker Data • Backend Integration (Beta)
      </div>
    </div>
    <div style="background:rgba(239,68,68,0.15);border:2px solid var(--bad);border-radius:12px;padding:24px;margin-top:32px;text-align:center">
      <div style="font-size:1.8rem;margin-bottom:12px">⚠️ IMPORTANT MEDICAL DISCLAIMER ⚠️</div>
      <div style="font-size:1rem;line-height:1.7;max-width:900px;margin:0 auto">
        <p style="margin-bottom:16px"><strong style="font-size:1.1rem">This application is for tracking and monitoring purposes ONLY.</strong></p>
        <p style="margin-bottom:16px"><strong>DO NOT rely on this data, reference ranges, or recovery scores to make medical decisions.</strong> All reference ranges and alert thresholds are general guidelines and may not apply to your specific medical situation.</p>
        <p style="margin-bottom:16px"><strong>You MUST consult with your physician, cardiologist, or healthcare provider</strong> for proper medical advice, diagnosis, treatment decisions, and interpretation of your health data.</p>
        <p style="margin-bottom:0"><strong>In case of emergency or concerning symptoms, call 911 or go to the nearest emergency room immediately.</strong> Do not wait for your next scheduled appointment.</p>
      </div>
    </div>
  </div>
  <script>
    // Initialize date
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', {
      weekday: 'long',
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    });
    document.getElementById('entryDate').valueAsDate = new Date();
    document.getElementById('entryTime').value = new Date().toTimeString().slice(0,5);
    // Load saved surgery date and baseline weight from localStorage
    const savedSurgeryDate = localStorage.getItem('surgeryDate');
    const savedBaselineWeight = localStorage.getItem('baselineWeight');
    if(savedSurgeryDate) {
      document.getElementById('surgeryDate').value = savedSurgeryDate;
    }
    if(savedBaselineWeight) {
      document.getElementById('baselineWeight').value = savedBaselineWeight;
    }
    // Auto-calculate days post-op when entry date or surgery date changes
    function calculateDaysPostOp() {
      const surgeryDate = document.getElementById('surgeryDate').value;
      const entryDate = document.getElementById('entryDate').value;
      if(surgeryDate && entryDate) {
        const surgery = new Date(surgeryDate);
        const entry = new Date(entryDate);
        const diffTime = entry - surgery;
        const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
        document.getElementById('daysPostOp').value = diffDays >= 0 ? diffDays : 0;
      }
    }
    document.getElementById('surgeryDate').addEventListener('change', function() {
      localStorage.setItem('surgeryDate', this.value);
      calculateDaysPostOp();
    });
    document.getElementById('entryDate').addEventListener('change', calculateDaysPostOp);
    calculateDaysPostOp();
    // Auto-calculate weight deviation
    function calculateWeightDeviation() {
      const baseline = parseFloat(document.getElementById('baselineWeight').value);
      const current = parseFloat(document.getElementById('weight').value);
      if(baseline && current) {
        const deviation = current - baseline;
        const sign = deviation >= 0 ? '+' : '';
        document.getElementById('weightDeviation').value = sign + deviation.toFixed(1) + ' lbs/kg';
        // Flag if gaining more than 2 lbs
        if(deviation > 2) {
          document.getElementById('weightDeviation').style.color = 'var(--bad)';
          document.getElementById('weightDeviation').style.fontWeight = '700';
        } else {
          document.getElementById('weightDeviation').style.color = 'var(--ink)';
          document.getElementById('weightDeviation').style.fontWeight = '600';
        }
      }
    }
    document.getElementById('baselineWeight').addEventListener('input', function() {
      localStorage.setItem('baselineWeight', this.value);
      calculateWeightDeviation();
    });
    document.getElementById('weight').addEventListener('input', calculateWeightDeviation);
    // Auto-calculate fluid balance
    function calculateFluidBalance() {
      const restriction = parseFloat(document.getElementById('fluidRestriction').value);
      const intake = parseFloat(document.getElementById('fluidIntake').value);
      if(restriction && intake) {
        const balance = intake - restriction;
        const sign = balance >= 0 ? '+' : '';
        document.getElementById('fluidBalance').value = sign + balance + ' mL/oz';
        // Flag if over restriction
        if(balance > 0) {
          document.getElementById('fluidBalance').style.color = 'var(--warn)';
          document.getElementById('fluidBalance').style.fontWeight = '700';
        } else {
          document.getElementById('fluidBalance').style.color = 'var(--good)';
          document.getElementById('fluidBalance').style.fontWeight = '600';
        }
      }
    }
    document.getElementById('fluidRestriction').addEventListener('input', calculateFluidBalance);
    document.getElementById('fluidIntake').addEventListener('input', calculateFluidBalance);
    // Generate pain scales
    function createPainScale(containerId, fieldName) {
      const container = document.getElementById(containerId);
      for(let i = 0; i <= 10; i++) {
        const btn = document.createElement('div');
        btn.className = 'pain-btn';
        btn.textContent = i;
        btn.dataset.value = i;
        btn.dataset.field = fieldName;
        btn.addEventListener('click', function() {
          container.querySelectorAll('.pain-btn').forEach(b => {
            b.classList.remove('selected', 'high');
          });
          this.classList.add('selected');
          if(i >= 7) this.classList.add('high');
        });
        container.appendChild(btn);
      }
    }
    createPainScale('chestPainScale', 'chestPain');
    createPainScale('bodyPainScale', 'bodyPain');
    // Generate wellbeing scale
    function createWellbeingScale() {
      const container = document.getElementById('wellbeingScale');
      for(let i = 1; i <= 10; i++) {
        const btn = document.createElement('div');
        btn.className = 'wellbeing-btn';
        btn.textContent = i;
        btn.dataset.value = i;
        btn.addEventListener('click', function() {
          container.querySelectorAll('.wellbeing-btn').forEach(b => {
            b.classList.remove('selected', 'high', 'low');
          });
          this.classList.add('selected');
          if(i >= 8) this.classList.add('high');
          if(i <= 3) this.classList.add('low');
        });
        container.appendChild(btn);
      }
    }
    createWellbeingScale();
    // Generate ADL scales
    function createADLScales() {
      document.querySelectorAll('.adl-scale').forEach(container => {
        const adlName = container.dataset.adl;
        for(let i = 1; i <= 10; i++) {
          const btn = document.createElement('div');
          btn.className = 'adl-btn';
          btn.textContent = i;
          btn.dataset.value = i;
          btn.dataset.adl = adlName;
          btn.addEventListener('click', function() {
            container.querySelectorAll('.adl-btn').forEach(b => {
              b.classList.remove('selected', 'high', 'low');
            });
            this.classList.add('selected');
            if(i >= 8) this.classList.add('high');
            if(i <= 3) this.classList.add('low');
          });
          container.appendChild(btn);
        }
      });
    }
    createADLScales();
    // Walking sessions management
    let walkingSessionCount = 0;
    function addWalkingSession() {
      walkingSessionCount++;
      const container = document.getElementById('walkingSessionsContainer');
      const sessionDiv = document.createElement('div');
      sessionDiv.className = 'walking-session';
      sessionDiv.innerHTML = `
        <input type="number" placeholder="Session ${walkingSessionCount} minutes" data-session="${walkingSessionCount}">
        <button type="button" onclick="this.parentElement.remove()">Remove</button>
      `;
      container.appendChild(sessionDiv);
    }
    document.getElementById('addWalkingSession').addEventListener('click', addWalkingSession);
    addWalkingSession();
    // Handle checkbox styling
    document.querySelectorAll('.checkbox-item input').forEach(cb => {
      cb.addEventListener('change', function() {
        if(this.checked) {
          this.closest('.checkbox-item').classList.add('checked');
        } else {
          this.closest('.checkbox-item').classList.remove('checked');
        }
      });
    });
    // SESSION 2: Medication Adherence Dose Trackers
    function createDoseTracker(containerSelector, medName, defaultDoses = 2) {
      const container = document.querySelector(containerSelector);
      const doseInput = document.getElementById(medName + 'Doses');
      const statusEl = document.getElementById(medName + 'AdherenceStatus');
     
      function updateTracker() {
        const numDoses = parseInt(doseInput.value) || defaultDoses;
        container.innerHTML = '';
       
        for(let i = 1; i <= numDoses; i++) {
          const slot = document.createElement('div');
          slot.className = 'dose-slot';
          slot.textContent = `Dose ${i}`;
          slot.dataset.dose = i;
          slot.dataset.status = 'pending';
         
          slot.addEventListener('click', function() {
            if(this.dataset.status === 'pending') {
              this.dataset.status = 'taken';
              this.classList.add('taken');
              this.textContent = `Dose ${i} ✓`;
            } else if(this.dataset.status === 'taken') {
              this.dataset.status = 'missed';
              this.classList.remove('taken');
              this.classList.add('missed');
              this.textContent = `Dose ${i} ✗`;
            } else {
              this.dataset.status = 'pending';
              this.classList.remove('missed');
              this.textContent = `Dose ${i}`;
            }
            updateAdherenceStatus();
          });
         
          container.appendChild(slot);
        }
        updateAdherenceStatus();
      }
     
      function updateAdherenceStatus() {
        const slots = container.querySelectorAll('.dose-slot');
        const taken = Array.from(slots).filter(s => s.dataset.status === 'taken').length;
        const missed = Array.from(slots).filter(s => s.dataset.status === 'missed').length;
        const total = slots.length;
       
        if(taken === total) {
          statusEl.textContent = 'Fully Compliant';
          statusEl.className = 'adherence-status compliant';
        } else if(missed > 0) {
          statusEl.textContent = `${missed} Dose(s) Missed`;
          statusEl.className = 'adherence-status skipped';
        } else if(taken > 0) {
          statusEl.textContent = `${taken}/${total} Taken`;
          statusEl.className = 'adherence-status missed';
        } else {
          statusEl.textContent = 'Not Set';
          statusEl.className = 'adherence-status';
        }
      }
     
      doseInput.addEventListener('change', updateTracker);
      updateTracker();
    }
   
    createDoseTracker('#betaBlockerDoseTracker', 'betaBlocker', 2);
    createDoseTracker('#diureticDoseTracker', 'diuretic', 2);
    createDoseTracker('#anticoagulantDoseTracker', 'anticoagulant', 1);
    createDoseTracker('#antiarrhythmicDoseTracker', 'antiarrhythmic', 1);
    // SESSION 2: Side Effect Severity Buttons
    document.querySelectorAll('.severity-scale').forEach(scale => {
      const effectName = scale.dataset.effect;
      scale.querySelectorAll('.severity-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          scale.querySelectorAll('.severity-btn').forEach(b => b.classList.remove('selected'));
          this.classList.add('selected');
        });
      });
    });
    // SESSION 2: Wound Photo Upload Handler
    document.getElementById('woundPhotos').addEventListener('change', function(e) {
      const preview = document.getElementById('photoPreview');
      preview.innerHTML = '';
     
      Array.from(e.target.files).forEach((file, index) => {
        const reader = new FileReader();
        reader.onload = function(e) {
          const img = document.createElement('img');
          img.src = e.target.result;
          preview.appendChild(img);
        };
        reader.readAsDataURL(file);
      });
    });
    // SESSION 2: Post-Op Complication Alert
    document.querySelectorAll('input[name="pericardiotomy"], input[name="pleural"], input[name="pericardial"], input[name="tamponade"]').forEach(cb => {
      cb.addEventListener('change', function() {
        const anyChecked =
          document.querySelectorAll('input[name="pericardiotomy"]:checked').length > 0 ||
          document.querySelectorAll('input[name="pleural"]:checked').length > 0 ||
          document.querySelectorAll('input[name="pericardial"]:checked').length > 0 ||
          document.querySelectorAll('input[name="tamponade"]:checked').length > 0;
       
        document.getElementById('complicationAlert').style.display = anyChecked ? 'block' : 'none';
      });
    });
    // SESSION 3: PHQ-9 Depression Screening
    function initPHQ9() {
      const questions = document.querySelectorAll('.phq9-options');
      const scoreDisplay = document.getElementById('phq9ScoreDisplay');
      const scoreNumber = document.getElementById('phq9Score');
      const scoreSeverity = document.getElementById('phq9Severity');
      const crisisBox = document.getElementById('phq9CrisisBox');
     
      questions.forEach(questionGroup => {
        questionGroup.querySelectorAll('.phq9-option').forEach(option => {
          option.addEventListener('click', function() {
            questionGroup.querySelectorAll('.phq9-option').forEach(opt => {
              opt.classList.remove('selected');
            });
            this.classList.add('selected');
            calculatePHQ9Score();
          });
        });
      });
     
      function calculatePHQ9Score() {
        let totalScore = 0;
        let allAnswered = true;
        let q9Value = 0;
       
        questions.forEach((questionGroup, index) => {
          const selected = questionGroup.querySelector('.phq9-option.selected');
          if(selected) {
            const value = parseInt(selected.dataset.value);
            totalScore += value;
            if(index === 8) q9Value = value; // Question 9 about self-harm
          } else {
            allAnswered = false;
          }
        });
       
        if(allAnswered) {
          scoreDisplay.style.display = 'block';
          scoreNumber.textContent = totalScore;
         
          // Show crisis resources if Q9 > 0
          if(q9Value > 0) {
            crisisBox.style.display = 'block';
          } else {
            crisisBox.style.display = 'none';
          }
         
          // Determine severity
          let severity, className;
          if(totalScore <= 4) {
            severity = 'Minimal Depression';
            className = 'minimal';
          } else if(totalScore <= 9) {
            severity = 'Mild Depression';
            className = 'mild';
          } else if(totalScore <= 14) {
            severity = 'Moderate Depression';
            className = 'moderate';
          } else if(totalScore <= 19) {
            severity = 'Moderately Severe Depression';
            className = 'moderately-severe';
          } else {
            severity = 'Severe Depression';
            className = 'severe';
          }
         
          scoreSeverity.textContent = severity;
          scoreDisplay.className = 'phq9-score-display ' + className;
        } else {
          scoreDisplay.style.display = 'none';
          crisisBox.style.display = 'none';
        }
      }
    }
    initPHQ9();
    // SESSION 3: Exercise Prescription vs Actual Comparison
    function updateExerciseComparisons() {
      // Distance comparison
      const walkTarget = parseFloat(document.getElementById('walkTargetDistance').value);
      const walkActual = parseFloat(document.getElementById('walkActualDistance').value);
      const walkStatus = document.getElementById('walkDistanceStatus');
     
      if(walkTarget && walkActual) {
        const percentage = (walkActual / walkTarget) * 100;
        if(percentage >= 100) {
          walkStatus.textContent = '✓ Exceeded';
          walkStatus.className = 'exercise-achievement exceeded';
        } else if(percentage >= 80) {
          walkStatus.textContent = '✓ Met Goal';
          walkStatus.className = 'exercise-achievement met';
        } else {
          walkStatus.textContent = `${percentage.toFixed(0)}% of goal`;
          walkStatus.className = 'exercise-achievement below';
        }
      } else {
        walkStatus.textContent = '--';
        walkStatus.className = 'exercise-achievement';
      }
     
      // Duration comparison
      const durationTarget = parseFloat(document.getElementById('exerciseTargetDuration').value);
      const durationActual = parseFloat(document.getElementById('exerciseActualDuration').value);
      const durationStatus = document.getElementById('exerciseDurationStatus');
     
      if(durationTarget && durationActual) {
        const percentage = (durationActual / durationTarget) * 100;
        if(percentage >= 100) {
          durationStatus.textContent = '✓ Exceeded';
          durationStatus.className = 'exercise-achievement exceeded';
        } else if(percentage >= 80) {
          durationStatus.textContent = '✓ Met Goal';
          durationStatus.className = 'exercise-achievement met';
        } else {
          durationStatus.textContent = `${percentage.toFixed(0)}% of goal`;
          durationStatus.className = 'exercise-achievement below';
        }
      } else {
        durationStatus.textContent = '--';
        durationStatus.className = 'exercise-achievement';
      }
     
      // Heart Rate comparison
      const hrTarget = document.getElementById('exerciseTargetHR').value;
      const hrActual = parseFloat(document.getElementById('exerciseActualHR').value);
      const hrStatus = document.getElementById('exerciseHRStatus');
     
      if(hrTarget && hrActual) {
        const range = hrTarget.split('-').map(v => parseInt(v.trim()));
        if(range.length === 2) {
          if(hrActual >= range[0] && hrActual <= range[1]) {
            hrStatus.textContent = '✓ In Zone';
            hrStatus.className = 'exercise-achievement met';
          } else if(hrActual < range[0]) {
            hrStatus.textContent = 'Below Zone';
            hrStatus.className = 'exercise-achievement below';
          } else {
            hrStatus.textContent = 'Above Zone';
            hrStatus.className = 'exercise-achievement below';
          }
        }
      } else {
        hrStatus.textContent = '--';
        hrStatus.className = 'exercise-achievement';
      }
     
      // Peak HR comparison
      const maxHR = parseFloat(document.getElementById('exerciseMaxHR').value);
      const peakHR = parseFloat(document.getElementById('exercisePeakHR').value);
      const peakStatus = document.getElementById('exercisePeakHRStatus');
     
      if(maxHR && peakHR) {
        if(peakHR <= maxHR) {
          peakStatus.textContent = '✓ Safe';
          peakStatus.className = 'exercise-achievement met';
        } else {
          peakStatus.textContent = 'Exceeded Max';
          peakStatus.className = 'exercise-achievement below';
        }
      } else {
        peakStatus.textContent = '--';
        peakStatus.className = 'exercise-achievement';
      }
    }
   
    ['walkTargetDistance', 'walkActualDistance', 'exerciseTargetDuration', 'exerciseActualDuration',
     'exerciseTargetHR', 'exerciseActualHR', 'exerciseMaxHR', 'exercisePeakHR'].forEach(id => {
      document.getElementById(id).addEventListener('input', updateExerciseComparisons);
    });
    // SESSION 3: INR History Management
    let inrHistoryCount = 0;
    function addINRHistoryItem() {
      inrHistoryCount++;
      const container = document.getElementById('inrHistoryContainer');
      const item = document.createElement('div');
      item.className = 'inr-history-item';
      item.innerHTML = `
        <div class="inr-details">
          <input type="date" placeholder="Date" style="width:140px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:0.9rem">
          <input type="number" step="0.1" placeholder="INR" style="width:80px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:0.9rem">
          <input type="number" step="0.5" placeholder="Dose (mg)" style="width:100px;background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.12);color:var(--ink);padding:6px;border-radius:6px;font-size:0.9rem">
        </div>
        <button type="button" onclick="this.parentElement.remove()" style="padding:6px 12px;font-size:0.85rem">Remove</button>
      `;
      container.appendChild(item);
    }
    document.getElementById('addINRHistory').addEventListener('click', addINRHistoryItem);
    // SESSION 3: Provider Contact Status Checking
    function checkProviderStatuses() {
      const today = new Date();
      const providers = ['pcp', 'cardio', 'surgeon', 'ep', 'rehab'];
      let anyOverdue = false;
     
      providers.forEach(provider => {
        const nextAppt = document.getElementById(provider + 'NextAppt').value;
        const statusEl = document.getElementById(provider + 'Status');
       
        if(nextAppt) {
          const apptDate = new Date(nextAppt);
          const diffDays = Math.floor((apptDate - today) / (1000 * 60 * 60 * 24));
         
          if(diffDays < 0) {
            statusEl.textContent = 'Overdue';
            statusEl.className = 'provider-status overdue';
            anyOverdue = true;
          } else if(diffDays <= 7) {
            statusEl.textContent = 'Upcoming';
            statusEl.className = 'provider-status upcoming';
          } else {
            statusEl.textContent = 'Current';
            statusEl.className = 'provider-status current';
          }
        }
      });
     
      document.getElementById('overdueApptAlert').style.display = anyOverdue ? 'block' : 'none';
    }
   
    ['pcpNextAppt', 'cardioNextAppt', 'surgeonNextAppt', 'epNextAppt', 'rehabLastSession'].forEach(id => {
      document.getElementById(id).addEventListener('change', checkProviderStatuses);
    });
    checkProviderStatuses();
    // Local storage for entries
    let entries = JSON.parse(localStorage.getItem('cardiacEntries') || '[]');
    // RECOVERY SCORE ALGORITHM (HIGHER = BETTER!)
    function calculateRecoveryScore(entry) {
      let riskPoints = 0;
      let maxPoints = 100;
     
      // VITAL SIGNS (20 points)
      if(entry.heartRate) {
        const hr = parseInt(entry.heartRate);
        if(hr > 110 || hr < 50) riskPoints += 5;
        else if(hr > 100 || hr < 55) riskPoints += 3;
      }
      if(entry.oxygenSat) {
        const ox = parseInt(entry.oxygenSat);
        if(ox < 90) riskPoints += 7;
        else if(ox < 92) riskPoints += 5;
        else if(ox < 94) riskPoints += 2;
      }
      if(entry.temperature) {
        const temp = parseFloat(entry.temperature);
        if(temp > 100.4) riskPoints += 5;
        else if(temp > 99.5) riskPoints += 2;
      }
      if(entry.bloodPressure) {
        const bp = entry.bloodPressure.split('/');
        if(bp.length === 2) {
          const sys = parseInt(bp[0]);
          const dia = parseInt(bp[1]);
          if(sys < 90 || sys > 160 || dia < 50 || dia > 100) riskPoints += 3;
        }
      }
     
      // CARDIAC RHYTHM (15 points)
      if(entry.rhythm === 'irregular') riskPoints += 8;
      if(entry.rhythm === 'intermittent-afib') riskPoints += 5;
      if(entry.palpitations === 'frequent' || entry.palpitations === 'constant') riskPoints += 4;
      if(entry.pacemakerIssues && entry.pacemakerIssues !== 'none') riskPoints += 3;
     
      // PAIN (15 points)
      if(entry.chestPain) {
        const pain = parseInt(entry.chestPain);
        if(pain >= 7) riskPoints += 10;
        else if(pain >= 5) riskPoints += 5;
        else if(pain >= 3) riskPoints += 2;
      }
      if(entry.incisionStatus && (entry.incisionStatus.includes('separation') || entry.incisionStatus.includes('concerning'))) {
        riskPoints += 5;
      }
     
      // Wound Assessment Risk
      if(entry.drainageColor && (entry.drainageColor.includes('green') || entry.drainageColor.includes('brown'))) {
        riskPoints += 8;
      }
      if(entry.woundEdges && (entry.woundEdges.includes('gaping') || entry.woundEdges.includes('dehiscence'))) {
        riskPoints += 10;
      }
      if(entry.woundWarmth === 'hot') riskPoints += 5;
     
      // SYMPTOMS (20 points)
      if(entry.shortnessOfBreath && (entry.shortnessOfBreath.includes('rest') || entry.shortnessOfBreath.includes('lying') || entry.shortnessOfBreath.includes('night'))) {
        riskPoints += 8;
      } else if(entry.shortnessOfBreath && entry.shortnessOfBreath.includes('minimal')) {
        riskPoints += 4;
      }
      if(entry.fatigue === 'extreme') riskPoints += 5;
      else if(entry.fatigue === 'severe') riskPoints += 3;
      if(entry.dizziness === 'syncope') riskPoints += 6;
      else if(entry.dizziness === 'severe') riskPoints += 4;
      if(entry.swelling && entry.swelling !== 'none') riskPoints += 3;
     
      // Post-Op Complications
      if(entry.complicationSymptoms && entry.complicationSymptoms.length > 0) {
        riskPoints += Math.min(entry.complicationSymptoms.length * 5, 20);
      }
     
      // WARNING SYMPTOMS (20 points)
      if(entry.warningSymptoms && entry.warningSymptoms.length > 0) {
        riskPoints += Math.min(entry.warningSymptoms.length * 4, 20);
      }
     
      // LAB VALUES (10 points)
      if(entry.inr) {
        const inr = parseFloat(entry.inr);
        if(inr < 1.5 || inr > 3.5) riskPoints += 5;
        else if(inr < 2.0 || inr > 3.0) riskPoints += 2;
      }
      if(entry.potassiumLevel) {
        const k = parseFloat(entry.potassiumLevel);
        if(k < 3.2 || k > 5.5) riskPoints += 5;
      }
     
      // Medication Adherence
      if(entry.medicationAdherence) {
        const totalMissed =
          (entry.medicationAdherence.betaBlockerMissed || 0) +
          (entry.medicationAdherence.diureticMissed || 0) +
          (entry.medicationAdherence.anticoagulantMissed || 0) +
          (entry.medicationAdherence.antiarrhythmicMissed || 0);
       
        if(totalMissed >= 3) riskPoints += 10;
        else if(totalMissed >= 2) riskPoints += 6;
        else if(totalMissed >= 1) riskPoints += 3;
      }
     
      // Side Effects
      if(entry.sideEffects) {
        const severeSideEffects = Object.values(entry.sideEffects).filter(v => v >= 3).length;
        if(severeSideEffects > 0) riskPoints += severeSideEffects * 3;
      }
     
      // SESSION 3: PHQ-9 Depression Score
      if(entry.phq9Score) {
        const phq9 = parseInt(entry.phq9Score);
        if(phq9 >= 20) riskPoints += 10;
        else if(phq9 >= 15) riskPoints += 7;
        else if(phq9 >= 10) riskPoints += 4;
        else if(phq9 >= 5) riskPoints += 2;
      }
     
      // ACTIVITY TOLERANCE & ADLs (10 points)
      if(entry.activityTolerance === 'bedbound') riskPoints += 5;
      else if(entry.activityTolerance === 'poor') riskPoints += 3;
     
      // Check ADL scores
      if(entry.adlScores) {
        const avgADL = Object.values(entry.adlScores).reduce((a,b) => a+b, 0) / Object.values(entry.adlScores).length;
        if(avgADL <= 3) riskPoints += 5;
        else if(avgADL <= 5) riskPoints += 2;
      }
     
      // WELLBEING SCORE (10 points)
      if(entry.wellbeingScore) {
        const wb = parseInt(entry.wellbeingScore);
        if(wb <= 3) riskPoints += 8;
        else if(wb <= 5) riskPoints += 5;
        else if(wb <= 6) riskPoints += 2;
      }
     
      // CONVERT TO RECOVERY SCORE (higher = better!)
      const recoveryScore = Math.max(0, maxPoints - riskPoints);
     
      // Determine grade and status
      let grade, status, className, message;
      if(recoveryScore >= 85) {
        grade = 'A';
        status = 'Excellent Recovery';
        className = 'excellent';
        message = '🎉 Outstanding progress! Recovery is going excellently.';
      } else if(recoveryScore >= 70) {
        grade = 'B';
        status = 'Good Recovery';
        className = 'good';
        message = '👍 Good progress. Continue with current care plan.';
      } else if(recoveryScore >= 50) {
        grade = 'C';
        status = 'Fair - Monitor Closely';
        className = 'fair';
        message = '⚠️ Some concerning signs. Discuss with care team at next appointment.';
      } else if(recoveryScore >= 30) {
        grade = 'D';
        status = 'Poor - Contact Doctor';
        className = 'poor';
        message = '🚨 Multiple concerning symptoms. Contact your care team today.';
      } else {
        grade = 'F';
        status = 'Critical - Seek Immediate Care';
        className = 'critical';
        message = '🚨🚨 CRITICAL: Multiple severe symptoms detected. Call doctor immediately or go to ER.';
      }
     
      return {
        recoveryScore,
        grade,
        status,
        className,
        message
      };
    }
    // Form submission
    document.getElementById('dataForm').addEventListener('submit', function(e) {
      e.preventDefault();
     
      // Collect walking sessions
      const walkingSessions = [];
      document.querySelectorAll('#walkingSessionsContainer input[type="number"]').forEach(input => {
        if(input.value) {
          walkingSessions.push({
            session: input.dataset.session,
            minutes: input.value
          });
        }
      });
     
      // Collect ADL scores
      const adlScores = {};
      document.querySelectorAll('.adl-scale').forEach(scale => {
        const adlName = scale.dataset.adl;
        const selected = scale.querySelector('.adl-btn.selected');
        if(selected) {
          adlScores[adlName] = parseInt(selected.dataset.value);
        }
      });
      // Collect Medication Adherence
      function getMedAdherence(medName) {
        const container = document.getElementById(medName + 'DoseTracker');
        const slots = container.querySelectorAll('.dose-slot');
        const taken = Array.from(slots).filter(s => s.dataset.status === 'taken').length;
        const missed = Array.from(slots).filter(s => s.dataset.status === 'missed').length;
        const total = slots.length;
        return { taken, missed, total, schedule: document.getElementById(medName + 'Schedule').value };
      }
      const medicationAdherence = {
        betaBlocker: getMedAdherence('betaBlocker'),
        betaBlockerMissed: getMedAdherence('betaBlocker').missed,
        diuretic: getMedAdherence('diuretic'),
        diureticMissed: getMedAdherence('diuretic').missed,
        anticoagulant: getMedAdherence('anticoagulant'),
        anticoagulantMissed: getMedAdherence('anticoagulant').missed,
        antiarrhythmic: getMedAdherence('antiarrhythmic'),
        antiarrhythmicMissed: getMedAdherence('antiarrhythmic').missed,
        missedReasons: document.getElementById('missedDoseReasons').value
      };
      // Collect Side Effects
      const sideEffects = {};
      document.querySelectorAll('.severity-scale').forEach(scale => {
        const selected = scale.querySelector('.severity-btn.selected');
        if(selected) {
          sideEffects[scale.dataset.effect] = parseInt(selected.dataset.value);
        }
      });
      // Collect Post-Op Complications
      const complicationSymptoms = [
        ...Array.from(document.querySelectorAll('input[name="pericardiotomy"]:checked')).map(cb => 'Pericardiotomy: ' + cb.value),
        ...Array.from(document.querySelectorAll('input[name="pleural"]:checked')).map(cb => 'Pleural: ' + cb.value),
        ...Array.from(document.querySelectorAll('input[name="pericardial"]:checked')).map(cb => 'Pericardial: ' + cb.value),
        ...Array.from(document.querySelectorAll('input[name="tamponade"]:checked')).map(cb => 'Tamponade: ' + cb.value)
      ];
      // Collect Vitamin K Data
      const vitaminKFoods = Array.from(document.querySelectorAll('input[name="vitaminK"]:checked')).map(cb => ({
        food: cb.value,
        level: cb.dataset.level
      }));
      // SESSION 3: Collect PHQ-9 Score
      const phq9Options = document.querySelectorAll('.phq9-options');
      let phq9Score = 0;
      let phq9Answered = true;
      phq9Options.forEach(group => {
        const selected = group.querySelector('.phq9-option.selected');
        if(selected) {
          phq9Score += parseInt(selected.dataset.value);
        } else {
          phq9Answered = false;
        }
      });
      // SESSION 3: Collect Exercise Data
      const exerciseData = {
        walkTarget: document.getElementById('walkTargetDistance').value,
        walkActual: document.getElementById('walkActualDistance').value,
        durationTarget: document.getElementById('exerciseTargetDuration').value,
        durationActual: document.getElementById('exerciseActualDuration').value,
        hrTarget: document.getElementById('exerciseTargetHR').value,
        hrActual: document.getElementById('exerciseActualHR').value,
        maxHR: document.getElementById('exerciseMaxHR').value,
        peakHR: document.getElementById('exercisePeakHR').value,
        notes: document.getElementById('exerciseNotes').value,
        nextRehabDate: document.getElementById('nextRehabDate').value,
        rehabFrequency: document.getElementById('rehabFrequency').value
      };
      // SESSION 3: Collect Provider Data
      const providerData = {
        pcp: {
          name: document.getElementById('pcpName').value,
          phone: document.getElementById('pcpPhone').value,
          lastContact: document.getElementById('pcpLastContact').value,
          nextAppt: document.getElementById('pcpNextAppt').value,
          interval: document.getElementById('pcpInterval').value
        },
        cardio: {
          name: document.getElementById('cardioName').value,
          phone: document.getElementById('cardioPhone').value,
          lastContact: document.getElementById('cardioLastContact').value,
          nextAppt: document.getElementById('cardioNextAppt').value,
          interval: document.getElementById('cardioInterval').value
        },
        surgeon: {
          name: document.getElementById('surgeonName').value,
          phone: document.getElementById('surgeonPhone').value,
          lastContact: document.getElementById('surgeonLastContact').value,
          nextAppt: document.getElementById('surgeonNextAppt').value,
          interval: document.getElementById('surgeonInterval').value
        },
        ep: {
          name: document.getElementById('epName').value,
          phone: document.getElementById('epPhone').value,
          lastContact: document.getElementById('epLastContact').value,
          nextAppt: document.getElementById('epNextAppt').value,
          interval: document.getElementById('epInterval').value
        },
        rehab: {
          name: document.getElementById('rehabName').value,
          phone: document.getElementById('rehabPhone').value,
          lastSession: document.getElementById('rehabLastSession').value,
          sessionsPerWeek: document.getElementById('rehabSessionsPerWeek').value,
          totalSessions: document.getElementById('rehabTotalSessions').value,
          completedSessions: document.getElementById('rehabCompletedSessions').value
        }
      };
      // SESSION 3: Collect Anticoagulation Data
      const anticoagData = {
        provider: document.getElementById('inrProvider').value,
        providerName: document.getElementById('inrProviderName').value,
        providerPhone: document.getElementById('inrProviderPhone').value,
        todayINR: document.getElementById('todayINR').value,
        todayDose: document.getElementById('todayWarfarinDose').value,
        doseChange: document.getElementById('warfarinDoseChange').value,
        newInstructions: document.getElementById('warfarinNewDoseInstructions').value,
        nextINRDate: document.getElementById('nextINRDate').value,
        nextINRLocation: document.getElementById('nextINRLocation').value,
        nextINRTime: document.getElementById('nextINRTime').value,
        notes: document.getElementById('anticoagNotes').value
      };
      // SESSION 3: Collect Home Device Data
      const deviceData = {
        bpMonitor: {
          time: document.getElementById('bpDeviceTime').value,
          brand: document.getElementById('bpDeviceBrand').value,
          reading: document.getElementById('bpDeviceReading').value,
          pulse: document.getElementById('bpDevicePulse').value,
          arm: document.getElementById('bpArm').value,
          position: document.getElementById('bpPosition').value
        },
        pulseOx: {
          time: document.getElementById('pulseOxTime').value,
          brand: document.getElementById('pulseOxBrand').value,
          spo2: document.getElementById('pulseOxReading').value,
          hr: document.getElementById('pulseOxHR').value,
          finger: document.getElementById('pulseOxFinger').value,
          quality: document.getElementById('pulseOxQuality').value
        },
        scale: {
          time: document.getElementById('scaleTime').value,
          brand: document.getElementById('scaleBrand').value,
          weight: document.getElementById('scaleReading').value,
          timing: document.getElementById('scaleTimimg').value
        },
        pacemaker: {
          time: document.getElementById('pacemakerTime').value,
          system: document.getElementById('pacemakerSystem').value,
          transmission: document.getElementById('pacemakerTransmission').value,
          alerts: document.getElementById('pacemakerAlerts').value,
          atrialPaced: document.getElementById('pacemakerAtrialPaced').value, // Session 4 addition
          ventricularPaced: document.getElementById('pacemakerVentricularPaced').value, // Session 4 addition
          battery: document.getElementById('pacemakerBattery').value, // Session 4 addition
          atrialImpedance: document.getElementById('pacemakerAtrialImpedance').value, // Session 4 addition
          ventricularImpedance: document.getElementById('pacemakerVentricularImpedance').value, // Session 4 addition
          data: document.getElementById('pacemakerData').value
        },
        notes: document.getElementById('deviceNotes').value
      };
     
      const formData = {
        timestamp: new Date().toISOString(),
        date: document.getElementById('entryDate').value,
        time: document.getElementById('entryTime').value,
        surgeryDate: document.getElementById('surgeryDate').value,
        daysPostOp: document.getElementById('daysPostOp').value,
        baselineWeight: document.getElementById('baselineWeight').value,
        weightDeviation: document.getElementById('weightDeviation').value,
       
        // SESSION 3: Device Data
        deviceData: deviceData,
       
        // Vitals
        weight: document.getElementById('weight').value,
        bloodPressure: document.getElementById('bloodPressure').value,
        heartRate: document.getElementById('heartRate').value,
        oxygenSat: document.getElementById('oxygenSat').value,
        temperature: document.getElementById('temperature').value,
        respRate: document.getElementById('respRate').value,
       
        // Cardiac
        rhythm: document.getElementById('rhythm').value,
        palpitations: document.getElementById('palpitations').value,
        pacemakerIssues: document.getElementById('pacemakerIssues').value,
       
        // Pain
        chestPain: document.querySelector('#chestPainScale .pain-btn.selected')?.dataset.value || '',
        chestPainTrend: document.getElementById('chestPainTrend').value, // Session 4 addition
        bodyPain: document.querySelector('#bodyPainScale .pain-btn.selected')?.dataset.value || '',
        bodyPainTrend: document.getElementById('bodyPainTrend').value, // Session 4 addition
        painLocation: document.getElementById('painLocation').value,
        painType: document.getElementById('painType').value,
        incisionStatus: document.getElementById('incisionStatus').value,
        painPosition: document.getElementById('painPosition').value,
        painTrigger: document.getElementById('painTrigger').value,
        painActivity: document.getElementById('painActivity').value,
        // Wound Assessment
        drainageAmount: document.getElementById('drainageAmount').value,
        drainageColor: document.getElementById('drainageColor').value,
        woundWarmth: document.getElementById('woundWarmth').value,
        rednessExtent: document.getElementById('rednessExtent').value,
        woundEdges: document.getElementById('woundEdges').value,
        surroundingSkin: document.getElementById('surroundingSkin').value,
       
        // Symptoms
        shortnessOfBreath: document.getElementById('shortnessOfBreath').value,
        fatigue: document.getElementById('fatigue').value,
        dizziness: document.getElementById('dizziness').value,
        swelling: document.getElementById('swelling').value,
        nausea: document.getElementById('nausea').value,
        sleepHours: document.getElementById('sleepHours').value,
        sleepPosition: document.getElementById('sleepPosition').value,
        wakingSOB: document.getElementById('wakingSOB').value,
        cough: document.getElementById('cough').value,
        mood: document.getElementById('mood').value,
        sternumClicking: document.getElementById('sternumClicking').value,
        bowelMovement: document.getElementById('bowelMovement').value,
        stoolConsistency: document.getElementById('stoolConsistency').value,
        bmStraining: document.getElementById('bmStraining').value,
        // Post-Op Complications
        complicationSymptoms: complicationSymptoms,
       
        // Sternal Precautions
        liftingCompliance: document.getElementById('liftingCompliance').value,
        pushPullCompliance: document.getElementById('pushPullCompliance').value,
        armMovement: document.getElementById('armMovement').value,
        drivingStatus: document.getElementById('drivingStatus').value,
        coughSplinting: document.getElementById('coughSplinting').value,
        sternumShift: document.getElementById('sternumShift').value,
       
        // ADLs
        adlScores: adlScores,
       
        // Fluids
        fluidRestriction: document.getElementById('fluidRestriction').value,
        fluidIntake: document.getElementById('fluidIntake').value,
        fluidBalance: document.getElementById('fluidBalance').value,
        urineOutput: document.getElementById('urineOutput').value,
        urineColor: document.getElementById('urineColor').value,
       
        // Medications with frequency
        diuretic: document.getElementById('diuretic').value,
        diureticFreq: document.getElementById('diureticFreq').value,
        anticoagulant: document.getElementById('anticoagulant').value,
        anticoagulantFreq: document.getElementById('anticoagulantFreq').value,
        betaBlocker: document.getElementById('betaBlocker').value,
        betaBlockerFreq: document.getElementById('betaBlockerFreq').value,
        antiarrhythmic: document.getElementById('antiarrhythmic').value,
        antiarrhythmicFreq: document.getElementById('antiarrhythmicFreq').value,
        aceInhibitor: document.getElementById('aceInhibitor').value,
        aceInhibitorFreq: document.getElementById('aceInhibitorFreq').value,
        painMed: document.getElementById('painMed').value,
        painMedFreq: document.getElementById('painMedFreq').value,
        potassium: document.getElementById('potassium').value,
        potassiumFreq: document.getElementById('potassiumFreq').value,
        otherCardiacMeds: document.getElementById('otherCardiacMeds').value,
        otherCardiacMedsFreq: document.getElementById('otherCardiacMedsFreq').value,
        // Medication Adherence
        medicationAdherence: medicationAdherence,
        // Side Effects
        sideEffects: sideEffects,
        otherSideEffects: document.getElementById('otherSideEffects').value,
        // Vitamin K Tracking
        onWarfarin: document.getElementById('onWarfarin').value,
        vitaminKConsistency: document.getElementById('vitaminKConsistency').value,
        vitaminKFoods: vitaminKFoods,
        vitaminKServings: document.getElementById('vitaminKServings').value,
        vitaminKSupplement: document.getElementById('vitaminKSupplement').value,
        vitaminKNotes: document.getElementById('vitaminKNotes').value,
        // SESSION 3: Anticoagulation
        anticoagData: anticoagData,
       
        // Labs
        inr: document.getElementById('inr').value,
        potassiumLevel: document.getElementById('potassiumLevel').value,
        magnesiumLevel: document.getElementById('magnesiumLevel').value,
        bnp: document.getElementById('bnp').value,
        creatinine: document.getElementById('creatinine').value,
        hemoglobin: document.getElementById('hemoglobin').value,
        rbc: document.getElementById('rbc').value,
        wbc: document.getElementById('wbc').value,
        nextLabDate: document.getElementById('nextLabDate').value,
       
        // Activity with walking sessions
        walkingSessions: walkingSessions,
        steps: document.getElementById('steps').value,
        cardiacRehab: document.getElementById('cardiacRehab').value,
        activityTolerance: document.getElementById('activityTolerance').value,
        stairs: document.getElementById('stairs').value,
        exerciseSOB: document.getElementById('exerciseSOB').value,
        // SESSION 3: Exercise Prescription
        exerciseData: exerciseData,
       
        // Menstrual cycle
        cycleStatus: document.getElementById('cycleStatus').value,
        cycleDay: document.getElementById('cycleDay').value,
        daysRelativeToPeriod: document.getElementById('daysRelativeToPeriod').value,
        flowHeaviness: document.getElementById('flowHeaviness').value,
        hormonalSymptoms: document.getElementById('hormonalSymptoms').value,
       
        // Wellbeing
        wellbeingScore: document.querySelector('#wellbeingScale .wellbeing-btn.selected')?.dataset.value || '',
        wellbeingSummary: document.getElementById('wellbeingSummary').value,
        // SESSION 3: PHQ-9 Score
        phq9Score: phq9Answered ? phq9Score : null,
        phq9Severity: phq9Answered ? document.getElementById('phq9Severity').textContent : null,
        // SESSION 3: Provider Data
        providerData: providerData,
       
        // Warning symptoms
        warningSymptoms: Array.from(document.querySelectorAll('input[name="symptom"]:checked')).map(cb => cb.value),
       
        // Notes
        notes: document.getElementById('notes').value
      };
     
      // Calculate recovery score
      const recoveryAssessment = calculateRecoveryScore(formData);
      formData.recoveryAssessment = recoveryAssessment;
     
      entries.unshift(formData);
      localStorage.setItem('cardiacEntries', JSON.stringify(entries));
     
      // SESSION 4 FEATURE 14: Backend Sync (Firebase example)
      // Note: Replace with your Firebase config. Ensure HIPAA compliance for production.
      // For demo, assuming Firebase is initialized.
      // if (firebase.auth().currentUser) {
      //   db.collection('users').doc(firebase.auth().currentUser.uid).collection('entries').add(formData)
      //     .then(() => console.log('Synced to cloud'))
      //     .catch(error => console.error('Sync error:', error));
      // } else {
      //   console.log('User not logged in - local only');
      // }
     
      // Alert if critical
      if(recoveryAssessment.className === 'critical') {
        alert('🚨 CRITICAL RECOVERY SCORE!\n\n' + recoveryAssessment.message + '\n\nPlease contact your medical provider immediately.');
      } else {
        alert('✅ Entry saved successfully!\n\nRecovery Score: ' + recoveryAssessment.recoveryScore + '/100 (Grade ' + recoveryAssessment.grade + ')\n' + recoveryAssessment.status);
      }
     
      renderEntries();
    });
    // Render entries
    function renderEntries() {
      const container = document.getElementById('entriesContainer');
     
      if(entries.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <p style="font-size:3rem;margin-bottom:12px">💓</p>
            <p>No entries yet. Create your first entry above!</p>
          </div>
        `;
        return;
      }
     
      container.innerHTML = entries.map((entry, index) => {
        const alerts = [];
       
        if(entry.heartRate && (parseInt(entry.heartRate) > 110 || parseInt(entry.heartRate) < 50)) {
          alerts.push('HR: ' + entry.heartRate);
        }
        if(entry.oxygenSat && parseInt(entry.oxygenSat) < 92) {
          alerts.push('Low O2: ' + entry.oxygenSat + '%');
        }
        if(entry.temperature && parseFloat(entry.temperature) > 100.4) {
          alerts.push('Fever: ' + entry.temperature + '°F');
        }
        if(entry.rhythm === 'irregular') {
          alerts.push('AFib');
        }
        if(entry.chestPain && parseInt(entry.chestPain) >= 7) {
          alerts.push('Severe chest pain: ' + entry.chestPain + '/10');
        }
        if(entry.shortnessOfBreath && (entry.shortnessOfBreath.includes('rest') || entry.shortnessOfBreath.includes('lying') || entry.shortnessOfBreath.includes('night'))) {
          alerts.push('Severe SOB');
        }
        if(entry.warningSymptoms && entry.warningSymptoms.length > 0) {
          alerts.push('⚠️ ' + entry.warningSymptoms.length + ' warning symptom(s)');
        }
        if(entry.complicationSymptoms && entry.complicationSymptoms.length > 0) {
          alerts.push('🚨 ' + entry.complicationSymptoms.length + ' complication symptom(s)');
        }
        if(entry.medicationAdherence) {
          const totalMissed =
            (entry.medicationAdherence.betaBlockerMissed || 0) +
            (entry.medicationAdherence.diureticMissed || 0) +
            (entry.medicationAdherence.anticoagulantMissed || 0) +
            (entry.medicationAdherence.antiarrhythmicMissed || 0);
          if(totalMissed > 0) {
            alerts.push('💊 ' + totalMissed + ' dose(s) missed');
          }
        }
        if(entry.phq9Score && parseInt(entry.phq9Score) >= 10) {
          alerts.push('🧠 PHQ-9: ' + entry.phq9Score + ' (' + entry.phq9Severity + ')');
        }
       
        const recovery = entry.recoveryAssessment || calculateRecoveryScore(entry);
       
        return `
          <div class="entry-card">
            <div class="entry-header">
              <span class="entry-date">💓 ${new Date(entry.date).toLocaleDateString()} ${entry.time || ''}</span>
              <span class="entry-time">Day ${entry.daysPostOp || '?'} post-op</span>
            </div>
           
            <div class="recovery-score-display ${recovery.className}">
              <div>
                <div class="score-number">${recovery.recoveryScore}</div>
                <div class="score-grade">Grade ${recovery.grade}</div>
                <div class="score-label">${recovery.status}</div>
              </div>
              <div style="text-align:right;max-width:60%">
                <div style="font-size:0.9rem">${recovery.message}</div>
              </div>
            </div>
           
            ${alerts.length > 0 ? `<div class="alert-summary">🚨 ${alerts.join(' • ')}</div>` : ''}
           
            <div class="entry-data">
              ${entry.weight ? `<div class="data-point"><span class="data-label">Weight</span><span class="data-value">${entry.weight}</span></div>` : ''}
              ${entry.weightDeviation ? `<div class="data-point"><span class="data-label">Weight Change</span><span class="data-value">${entry.weightDeviation}</span></div>` : ''}
              ${entry.bloodPressure ? `<div class="data-point"><span class="data-label">BP</span><span class="data-value">${entry.bloodPressure}</span></div>` : ''}
              ${entry.heartRate ? `<div class="data-point"><span class="data-label">HR</span><span class="data-value">${entry.heartRate} bpm</span></div>` : ''}
              ${entry.oxygenSat ? `<div class="data-point"><span class="data-label">O₂</span><span class="data-value">${entry.oxygenSat}%</span></div>` : ''}
              ${entry.rhythm ? `<div class="data-point"><span class="data-label">Rhythm</span><span class="data-value">${entry.rhythm}</span></div>` : ''}
              ${entry.chestPain ? `<div class="data-point"><span class="data-label">Chest Pain</span><span class="data-value">${entry.chestPain}/10</span></div>` : ''}
              ${entry.wellbeingScore ? `<div class="data-point"><span class="data-label">Well-Being</span><span class="data-value">${entry.wellbeingScore}/10</span></div>` : ''}
              ${entry.phq9Score ? `<div class="data-point"><span class="data-label">PHQ-9</span><span class="data-value">${entry.phq9Score}/27</span></div>` : ''}
              ${entry.drainageColor && entry.drainageColor !== 'none' ? `<div class="data-point"><span class="data-label">Drainage</span><span class="data-value">${entry.drainageColor}</span></div>` : ''}
              ${entry.woundEdges && entry.woundEdges !== 'well-approximated' ? `<div class="data-point"><span class="data-label">Wound Edges</span><span class="data-value" style="color:var(--warn)">${entry.woundEdges}</span></div>` : ''}
              ${entry.onWarfarin === 'yes' && entry.vitaminKServings ? `<div class="data-point"><span class="data-label">Vit K Servings</span><span class="data-value">${entry.vitaminKServings}</span></div>` : ''}
              ${entry.vitaminKConsistency === 'increased' || entry.vitaminKConsistency === 'decreased' ? `<div class="data-point"><span class="data-label">Vit K Change</span><span class="data-value" style="color:var(--warn)">${entry.vitaminKConsistency}</span></div>` : ''}
              ${entry.painPosition ? `<div class="data-point"><span class="data-label">Pain Position</span><span class="data-value">${entry.painPosition}</span></div>` : ''}
              ${entry.sleepPosition ? `<div class="data-point"><span class="data-label">Sleep Position</span><span class="data-value">${entry.sleepPosition}</span></div>` : ''}
              ${entry.bowelMovement ? `<div class="data-point"><span class="data-label">Last BM</span><span class="data-value">${entry.bowelMovement}</span></div>` : ''}
              ${entry.liftingCompliance && entry.liftingCompliance.includes('violation') ? `<div class="data-point"><span class="data-label">⚠️ Lifting</span><span class="data-value" style="color:var(--warn)">${entry.liftingCompliance}</span></div>` : ''}
              ${entry.sternumShift && entry.sternumShift !== 'no' ? `<div class="data-point"><span class="data-label">🚨 Sternum</span><span class="data-value" style="color:var(--bad)">${entry.sternumShift}</span></div>` : ''}
              ${entry.adlScores && Object.keys(entry.adlScores).length > 0 ? `<div class="data-point"><span class="data-label">Avg ADL Score</span><span class="data-value">${(Object.values(entry.adlScores).reduce((a,b) => a+b, 0) / Object.values(entry.adlScores).length).toFixed(1)}/10</span></div>` : ''}
              ${entry.steps ? `<div class="data-point"><span class="data-label">Steps</span><span class="data-value">${entry.steps}</span></div>` : ''}
              ${entry.walkingSessions && entry.walkingSessions.length > 0 ? `<div class="data-point"><span class="data-label">Walking</span><span class="data-value">${entry.walkingSessions.length} session(s)</span></div>` : ''}
              ${entry.exerciseData && entry.exerciseData.walkActual ? `<div class="data-point"><span class="data-label">Walk Distance</span><span class="data-value">${entry.exerciseData.walkActual} mi</span></div>` : ''}
              ${entry.exerciseData && entry.exerciseData.durationActual ? `<div class="data-point"><span class="data-label">Exercise Time</span><span class="data-value">${entry.exerciseData.durationActual} min</span></div>` : ''}
              ${entry.cycleStatus && entry.cycleStatus !== 'not-applicable' ? `<div class="data-point"><span class="data-label">Cycle</span><span class="data-value cycle-indicator">🌸 ${entry.cycleStatus}</span></div>` : ''}
              ${entry.anticoagData && entry.anticoagData.todayINR ? `<div class="data-point"><span class="data-label">Today INR</span><span class="data-value">${entry.anticoagData.todayINR}</span></div>` : ''}
            </div>
           
            ${entry.wellbeingSummary ? `<div style="margin-top:12px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.06);color:var(--cyan);font-weight:600;font-size:0.9rem">💭 "${entry.wellbeingSummary}"</div>` : ''}
            ${entry.notes ? `<div style="margin-top:8px;color:var(--muted);font-size:0.9rem">${entry.notes}</div>` : ''}
          </div>
        `;
      }).join('');
    }
    // Export to CSV
    document.getElementById('exportCsv').addEventListener('click', function() {
      if(entries.length === 0) {
        alert('No entries to export');
        return;
      }
     
      const headers = Object.keys(entries[0]).filter(k => k !== 'timestamp' && k !== 'recoveryAssessment' && k !== 'walkingSessions' && k !== 'adlScores' && k !== 'medicationAdherence' && k !== 'sideEffects' && k !== 'complicationSymptoms' && k !== 'vitaminKFoods' && k !== 'exerciseData' && k !== 'providerData' && k !== 'anticoagData' && k !== 'deviceData');
      headers.push('recoveryScore', 'recoveryGrade', 'recoveryStatus', 'phq9Score', 'phq9Severity');
     
      const csv = [
        headers.join(','),
        ...entries.map(entry => {
          const row = headers.map(h => {
            if(h === 'recoveryScore') return entry.recoveryAssessment?.recoveryScore || '';
            if(h === 'recoveryGrade') return entry.recoveryAssessment?.grade || '';
            if(h === 'recoveryStatus') return entry.recoveryAssessment?.status || '';
            if(h === 'phq9Score') return entry.phq9Score || '';
            if(h === 'phq9Severity') return entry.phq9Severity || '';
            let val = entry[h];
            if(Array.isArray(val)) val = val.join(';');
            if(typeof val === 'object') val = JSON.stringify(val);
            return `"${(val || '').toString().replace(/"/g, '""')}"`;
          });
          return row.join(',');
        })
      ].join('\n');
     
      const blob = new Blob([csv], {type: 'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'HEARTBEAT_Recovery_Log_Session3_' + new Date().toISOString().slice(0,10) + '.csv';
      a.click();
    });
    // Print/PDF
    document.getElementById('exportPdf').addEventListener('click', function() {
      window.print();
    });
    // Clear form
    document.getElementById('clearForm').addEventListener('click', function() {
      if(confirm('Clear all form fields?')) {
        document.getElementById('dataForm').reset();
        document.querySelectorAll('.pain-btn.selected, .wellbeing-btn.selected, .adl-btn.selected, .severity-btn.selected, .phq9-option.selected').forEach(btn => {
          btn.classList.remove('selected', 'high', 'low');
        });
        document.querySelectorAll('.checkbox-item.checked').forEach(item => {
          item.classList.remove('checked');
          item.querySelector('input').checked = false;
        });
        document.querySelectorAll('.dose-slot').forEach(slot => {
          slot.dataset.status = 'pending';
          slot.classList.remove('taken', 'missed');
          const doseNum = slot.dataset.dose;
          slot.textContent = `Dose ${doseNum}`;
        });
        document.getElementById('entryDate').valueAsDate = new Date();
        document.getElementById('entryTime').value = new Date().toTimeString().slice(0,5);
        document.getElementById('walkingSessionsContainer').innerHTML = '';
        document.getElementById('photoPreview').innerHTML = '';
        document.getElementById('inrHistoryContainer').innerHTML = '';
        document.getElementById('phq9ScoreDisplay').style.display = 'none';
        document.getElementById('phq9CrisisBox').style.display = 'none';
        walkingSessionCount = 0;
        inrHistoryCount = 0;
        addWalkingSession();
      }
    });
    // Clear history
    document.getElementById('clearHistory').addEventListener('click', function() {
      if(confirm('⚠️ This will delete ALL saved entries. Are you sure?')) {
        entries = [];
        localStorage.removeItem('cardiacEntries');
        renderEntries();
      }
    });
    // Initial render
    renderEntries();
    // SESSION 4 FEATURE 12: Real-time Input Validation
    function addRealTimeValidation() {
      // Heart Rate
      document.getElementById('heartRate').addEventListener('input', function() {
        const val = parseInt(this.value);
        if (val < 50 || val > 110) {
          this.style.borderColor = 'var(--bad)';
        } else if (val < 55 || val > 100) {
          this.style.borderColor = 'var(--warn)';
        } else {
          this.style.borderColor = 'rgba(255,255,255,0.12)';
        }
      });
      // Oxygen Saturation
      document.getElementById('oxygenSat').addEventListener('input', function() {
        const val = parseInt(this.value);
        if (val < 90) {
          this.style.borderColor = 'var(--bad)';
        } else if (val < 94) {
          this.style.borderColor = 'var(--warn)';
        } else {
          this.style.borderColor = 'rgba(255,255,255,0.12)';
        }
      });
      // Temperature
      document.getElementById('temperature').addEventListener('input', function() {
        const val = parseFloat(this.value);
        if (val > 100.4) {
          this.style.borderColor = 'var(--bad)';
        } else if (val > 99.5) {
          this.style.borderColor = 'var(--warn)';
        } else {
          this.style.borderColor = 'rgba(255,255,255,0.12)';
        }
      });
      // Blood Pressure
      document.getElementById('bloodPressure').addEventListener('input', function() {
        const bp = this.value.split('/');
        if (bp.length === 2) {
          const sys = parseInt(bp[0]);
          const dia = parseInt(bp[1]);
          if (sys < 90 || sys > 160 || dia < 50 || dia > 100) {
            this.style.borderColor = 'var(--bad)';
          } else if (sys < 100 || sys > 140 || dia < 60 || dia > 90) {
            this.style.borderColor = 'var(--warn)';
          } else {
            this.style.borderColor = 'rgba(255,255,255,0.12)';
          }
        } else {
          this.style.borderColor = 'rgba(255,255,255,0.12)';
        }
      });
      // Add more fields as needed (e.g., INR, weight, etc.)
      document.getElementById('inr').addEventListener('input', function() {
        const val = parseFloat(this.value);
        if (val < 1.5 || val > 3.5) {
          this.style.borderColor = 'var(--bad)';
        } else if (val < 2.0 || val > 3.0) {
          this.style.borderColor = 'var(--warn)';
        } else {
          this.style.borderColor = 'rgba(255,255,255,0.12)';
        }
      });
      // Weight (compare to baseline for >2 lbs gain)
      document.getElementById('weight').addEventListener('input', function() {
        const baseline = parseFloat(document.getElementById('baselineWeight').value);
        const current = parseFloat(this.value);
        if (baseline && current && current - baseline > 2) {
          this.style.borderColor = 'var(--bad)';
        } else {
          this.style.borderColor = 'rgba(255,255,255,0.12)';
        }
      });
    }
    addRealTimeValidation();
    // SESSION 4 FEATURE 14: Backend Initialization (Placeholder - Replace with real config)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY_HERE",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    // Uncomment to initialize
    // firebase.initializeApp(firebaseConfig);
    // const db = firebase.firestore();
    // For auth: firebase.auth().onAuthStateChanged(user => { /* handle user */ });
    // For EHR export: Add a button to generate JSON/CSV and suggest manual upload to physician portal.
  </script>
</body>
</html>
